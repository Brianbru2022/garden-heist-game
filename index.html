<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="manifest" href="manifest.json">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icon.png" type="image/png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="theme-color" content="#36454F">
    <meta name="mobile-web-app-capable" content="yes">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Garden Heist - Game</title>
    <style>
        /* General Body and Font Styling */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            font-family: sans-serif; /* Use system default sans-serif font for offline use */
            background: #fdfaf0; /* A slightly warmer background */
            color: #36454F; /* Charcoal */
            overflow: hidden; /* Prevent scrolling on the body */
        }

        /* Main Game Container */
        #game-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            box-sizing: border-box;
        }

        /* Screen Styling */
        .screen {
            display: none; /* Initially hide all screens with JS controlling visibility */
            flex-direction: column;
            justify-content: flex-start; /* Align content to the top */
            align-items: center;
            background: rgba(255, 255, 255, 0.97);
            border-radius: 20px;
            padding: 25px 30px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
            text-align: center;
            border: 1px solid #eee;
            animation: fadeIn 0.5s ease-in-out;
            max-height: 90vh; /* Ensure the box doesn't exceed screen height */
            overflow-y: auto; /* Allow scrolling within the box if content is too long */
            box-sizing: border-box; /* Ensures padding is included in the width/height */
        }

            .screen.active {
                display: flex; /* Show the active screen */
            }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* Styling for screen images, placed under the title */
        .screen-image {
            width: 100%; /* Image will now fill the width of the content box */
            height: auto;
            border-radius: 15px;
            margin-top: 15px; /* Space below title/subtitle */
            margin-bottom: 20px; /* Space above main text */
            background-color: #eee;
            object-fit: cover;
        }

        /* Text Styling */
        .title {
            font-size: clamp(1.8em, 5vw, 2.4em); /* Responsive font size */
            color: #36454F; /* Charcoal */
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: clamp(1em, 4vw, 1.2em);
            margin-bottom: 0; /* Adjusted margin */
            color: #5E5E5E; /* Darker grey */
        }

        .screen-subheader {
            font-size: 1.5em;
            margin-top: 20px;
            margin-bottom: 10px;
            border-bottom: 3px solid;
            padding-bottom: 5px;
            width: 100%;
            box-sizing: border-box;
        }

        .header-directions {
            border-color: #008080;
            color: #008080;
        }
        /* Teal */
        .header-story {
            border-color: #8B4513;
            color: #8B4513;
        }
        /* Warm Brown */
        .header-clue {
            border-color: #A52A2A;
            color: #A52A2A;
        }
        /* Deep Red */

        .clue-progress-indicator {
            font-size: clamp(0.8em, 2.5vw, 1em);
            font-weight: bold;
            color: #fff;
            background-color: #36454F; /* Charcoal */
            padding: 5px 10px;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            margin-top: 10px;
            display: inline-block;
        }

        p {
            line-height: 1.6;
            font-size: clamp(0.95em, 3.5vw, 1.1em);
            margin-top: 0;
            margin-bottom: 1em;
        }

        /* New Layout Containers for Story and Dialogue */
        .story-paragraph-container {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            text-align: left;
            margin-top: 15px;
            width: 100%;
            box-sizing: border-box;
        }

            .story-paragraph-container .icon {
                flex-shrink: 0;
                width: 24px;
                height: 24px;
                margin-top: 5px;
            }

                .story-paragraph-container .icon img {
                    width: 100%;
                    height: 100%;
                }

            .story-paragraph-container p {
                margin: 0;
                flex-grow: 1;
            }

        .dialogue-container {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            margin-bottom: 10px;
            padding: 15px;
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            width: 100%;
            box-sizing: border-box;
        }
        /* Character-specific dialogue backgrounds */
        .dialogue-hazel {
            background-color: #FFF8DC;
        }
        /* Soft Warm Gold (Cornsilk) */
        .dialogue-moo {
            background-color: #F0FFF0;
        }
        /* Cool Light Mint (Honeydew) */
        .dialogue-other {
            background-color: #F0F8FF;
        }
        /* Pale Grey-Blue (AliceBlue) */

        .dialogue-container .character-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            flex-shrink: 0;
            border: 2px solid #fff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .dialogue-container p {
            margin: 0;
            text-align: left;
            font-style: italic;
        }

        /* Directional Arrows Styling */
        .arrows-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .arrow-icon {
            width: 40px;
            height: 40px;
        }

        /* Input and Button Styling */
        input#detectiveName {
            font-size: 1.1em;
            padding: 12px 15px;
            border-radius: 10px;
            border: 2px solid #ddd;
            text-align: center;
            width: 80%;
            max-width: 300px;
            margin-bottom: 10px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

            input#detectiveName:focus {
                outline: none;
                border-color: #36454F;
                box-shadow: 0 0 10px rgba(54, 69, 79, 0.2);
            }

        .big-btn {
            display: inline-block;
            margin-top: 20px;
            font-size: clamp(1.1em, 4vw, 1.3em);
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            background: #36454F; /* Charcoal */
            color: #fff;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, opacity 0.2s;
            box-shadow: 0 4px 15px rgba(54, 69, 79, 0.2);
        }

            .big-btn:hover {
                transform: translateY(-3px);
                background-color: #2F3E46;
            }

            .big-btn:disabled {
                background-color: #b0bec5; /* Grey out disabled buttons */
                cursor: not-allowed;
                transform: none;
                box-shadow: none;
            }

            .big-btn.secondary { /* New class for secondary buttons */
                background-color: #78909c;
                box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            }

                .big-btn.secondary:hover {
                    background-color: #546e7a;
                }


        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }

        /* ---- Integrated Grid Selection Styling ---- */
        #selection-container, #notebook-view, #cypher-view {
            display: none; /* Hidden by default */
            width: 100%;
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #e0e0e0;
            background-color: #f9f9f9;
            box-sizing: border-box;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px; /* Reduced gap slightly */
            margin: 20px 0;
        }

        .grid-item {
            text-align: center;
            padding: 10px;
            border-radius: 12px;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s, border-color 0.3s;
            position: relative; /* Needed for the cross overlay */
            background-color: #fff;
        }

            .grid-item:hover {
                background-color: #f0f8ff;
                transform: scale(1.05);
            }

            .grid-item img {
                width: 80px;
                height: 80px;
                border-radius: 10px;
                object-fit: cover;
                background-color: #eee;
                pointer-events: none; /* Make sure click goes to the parent div */
            }

            .grid-item.selected {
                border-color: #36454F;
                background-color: #e0f2f1;
                transform: scale(1.05);
            }

            .grid-item.eliminated {
                opacity: 0.5;
                cursor: not-allowed;
                background-color: #f5f5f5;
            }

                .grid-item.eliminated:hover {
                    transform: none; /* Disable hover effect for eliminated items */
                }

                .grid-item.eliminated::after {
                    content: '❌';
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    font-size: 3rem;
                    color: red;
                    opacity: 0.8;
                    pointer-events: none; /* Make sure the cross doesn't intercept clicks */
                }

        #selection-feedback {
            margin-top: 15px;
            font-weight: bold;
            color: #36454F;
            min-height: 20px;
        }

        /* ---- Integrated Feedback Styling ---- */
        #feedback-container {
            display: none; /* Hidden by default */
            width: 100%;
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            border: 2px solid;
            box-sizing: border-box;
        }

            #feedback-container.correct {
                background-color: #e8f5e9; /* Light green */
                border-color: #4caf50; /* Green */
            }

            #feedback-container.incorrect {
                background-color: #ffebee; /* Light red */
                border-color: #f44336; /* Red */
            }

        #feedback-title {
            font-size: 1.8em;
            margin-top: 0;
            margin-bottom: 15px;
        }

        /* Popup Styling (Recap) */
        @keyframes pop-up-content {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            display: none; /* Controlled by JS */
            justify-content: center;
            align-items: center;
            padding: 15px;
            box-sizing: border-box;
            z-index: 1000;
            animation: fadeIn 0.2s;
        }

        .popup-content {
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            width: 100%;
            text-align: center;
            max-height: 90vh;
            overflow-y: auto;
            animation: pop-up-content 0.3s ease-out;
        }

        #recap-modal .popup-content {
            max-width: 500px;
        }

        #cypher-view img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-bottom: 15px;
        }

        /* Progress Screen Styling */
        .progress-graphic-container {
            position: relative;
            width: 120px;
            height: 120px;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .progress-ring {
            position: absolute;
            top: 0;
            left: 0;
        }

        .progress-ring__circle {
            transition: stroke-dashoffset 0.5s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            stroke: #008080; /* Teal */
        }

        .progress-ring__circle-bg {
            stroke: #e0e0e0;
        }

        .progress-percentage-text {
            font-size: 1.5em;
            font-weight: bold;
            color: #36454F;
        }

        .progress-label-text {
            font-size: 0.8em;
            color: #5E5E5E;
            margin-top: -5px;
        }

        @keyframes sparkle-animation {
            0% {
                text-shadow: 0 0 5px, 0 0 10px, 0 0 15px;
            }

            50% {
                text-shadow: 0 0 10px, 0 0 20px, 0 0 30px;
            }

            100% {
                text-shadow: 0 0 5px, 0 0 10px, 0 0 15px;
            }
        }

        .sparkle-gold {
            color: #FFD700;
            animation: sparkle-animation 1.5s infinite;
        }

        .sparkle-silver {
            color: #C0C0C0;
            animation: sparkle-animation 2s infinite;
        }

        .sparkle-bronze {
            color: #CD7F32;
            animation: sparkle-animation 2.5s infinite;
        }


        #milestones-container {
            position: relative;
            width: 80%;
            margin: 15px 0 10px 0;
            padding-top: 1.5rem;
        }

        @keyframes pop-in {
            0% {
                transform: translateX(-50%) scale(0);
            }

            70% {
                transform: translateX(-50%) scale(1.2);
            }

            100% {
                transform: translateX(-50%) scale(1);
            }
        }

        .milestone {
            position: absolute;
            bottom: 100%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            display: none; /* Hidden by default */
        }

            .milestone.active {
                display: block;
                animation: pop-in 0.5s ease-out;
            }

        #milestone-25 {
            left: 25%;
        }

        #milestone-50 {
            left: 50%;
        }

        #milestone-75 {
            left: 75%;
        }

        #milestone-100 {
            left: 100%;
        }

        #progress-bar-container {
            width: 100%;
            height: 30px;
            background-color: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        #progress-bar {
            width: 0%;
            height: 100%;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            background: repeating-linear-gradient(45deg, #36454F, #2F3E46 10px, #36454F 10px, #2F3E46 20px);
            background-size: 200% 200%;
            animation: progress-animation 2s linear infinite;
            transition: width 0.5s ease-in-out;
        }

        @keyframes progress-animation {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        #progress-summary {
            margin-top: 20px;
            font-size: clamp(0.9em, 3vw, 1em);
            color: #5d4037;
            background-color: #fafafa;
            padding: 10px;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }

        #timer-display {
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 15px;
            background-color: #e8f5e9;
            padding: 5px 15px;
            border-radius: 10px;
        }

        /* ---- Grand Reveal Screen Styling ---- */
        #grand-reveal-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            width: 100%;
        }

        .culprit-display {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 15px;
            border-radius: 12px;
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            width: 100%;
            box-sizing: border-box;
        }

            .culprit-display img {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                border: 4px solid #fff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            }

            .culprit-display h3 {
                margin: 5px 0 0 0;
                font-size: 1.4em;
            }

        /* ---- Score Breakdown Styling ---- */
        #score-breakdown {
            width: 100%;
            max-width: 300px;
            margin: 10px 0;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 12px;
        }

            #score-breakdown p {
                display: flex;
                justify-content: space-between;
                margin: 5px 0;
                font-size: 1em;
            }

                #score-breakdown p span:last-child {
                    font-weight: bold;
                }

        #final-score-line {
            border-top: 2px solid #36454F;
            margin-top: 10px;
            padding-top: 10px;
            font-size: 1.2em !important;
        }

        /* ---- Certificate Styling ---- */
        #certificate-content {
            border: 10px solid #36454F;
            padding: 20px;
            background-color: #fdfaf0;
            width: 100%;
            box-sizing: border-box;
        }

            #certificate-content h1 {
                font-family: 'serif';
                color: #8B4513;
            }

        #certificate-player-name {
            font-size: 1.5em;
            font-weight: bold;
            border-bottom: 2px solid #36454F;
            padding-bottom: 5px;
            margin: 20px 0;
        }

        #certificate-rank {
            font-style: italic;
        }

        .certificate-signature-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 30px;
        }

        .certificate-signature img {
            height: 60px;
            width: auto;
        }

        /* ---- Print Styling ---- */
        @media print {
            body * {
                visibility: hidden;
            }

            #certificate-screen, #certificate-screen * {
                visibility: visible;
            }

            #certificate-screen {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                max-width: 100%;
                max-height: 100%;
                border-radius: 0;
                box-shadow: none;
                border: none;
            }

            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body>

    <div id="game-container">

        <!-- NEW: Loading Screen -->
        <div id="loading-screen" class="screen active">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <p>Loading game assets...</p>
            <div id="loading-progress-bar-container" class="progress-bar-container" style="width: 80%;">
                <div id="loading-progress-bar" class="progress-bar" style="width: 0%;">0%</div>
            </div>
        </div>

        <!-- Each section is a "screen" in the game. JS will manage which one is active. -->
        <div id="welcome-screen" class="screen">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <div class="subtitle">A Wentworth Castle Gardens Mystery</div>
            <img src="garden-heist.png" alt="A mysterious garden" class="screen-image">
            <p>The legendary Golden Apple of Wentworth—said to grant the holder the power to tell the world's funniest jokes—has vanished from its pedestal! With the annual Garden Fête only hours away, a cloud of gloom (and terrible puns) hangs over the estate.</p>
            <p>The celebrated detective trio—the sharp-witted Hazel, the over-enthusiastic Moo, and you, their brilliant human partner—are called in. You must follow a trail of riddles through the sprawling gardens, eliminating crafty animal suspects and the bizarre objects they might have used to pull off the fruity felony.</p>
            <input id="detectiveName" placeholder="Detective Name" aria-label="Detective Name">
            <button id="start-button" class="big-btn">Start Investigation</button>
        </div>

        <div id="story-screen" class="screen">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <div class="subtitle">The Story Begins</div>
            <img src="welcome.png" alt="Welcome to the investigation" class="screen-image">
            <div id="story-screen-content"></div>
            <button id="story-continue-button" class="big-btn">Continue</button>
        </div>

        <div id="intro-story-screen" class="screen">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <div class="subtitle">A Mysterious Disappearance</div>
            <img src="intro.png" alt="Introduction image" class="screen-image">
            <div id="intro-story-content"></div>
            <button id="intro-story-next-button" class="big-btn">Let's find some clues</button>
        </div>

        <div id="clue-popup-screen" class="screen">
            <div class="title" id="clue-popup-title">🔎 Clue 1 - The Adventure Begins</div>
            <p>Get ready to solve the next clue!</p>
        </div>

        <div id="directions-screen" class="screen">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <div class="subtitle" id="directions-subtitle"></div>
            <div class="clue-progress-indicator" id="directions-progress"></div>
            <h3 class="screen-subheader header-directions">Directions</h3>
            <div id="directions-arrows-container" class="arrows-container"></div>
            <div id="directions-content"></div>
            <button id="directions-next-button" class="big-btn">Next</button>
        </div>

        <div id="clue-story-screen" class="screen">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <div class="subtitle" id="clue-story-subtitle"></div>
            <div class="clue-progress-indicator" id="clue-story-progress"></div>
            <img src="story-screen.png" alt="Story illustration" class="screen-image">
            <div id="clue-story-content"></div>
            <button id="clue-story-solve-button" class="big-btn">Examine the Clue</button>
        </div>

        <div id="task-screen" class="screen">
            <div class="title">🌳 The Garden Heist 🌳</div>
            <div class="subtitle" id="task-subtitle"></div>
            <div class="clue-progress-indicator" id="task-progress"></div>
            <img src="clues-screen.png" alt="Clue illustration" class="screen-image">

            <!-- Container for the main task view -->
            <div id="task-main-view">
                <div id="task-dialogue-container" class="dialogue-container">
                    <!-- Dialogue will be dynamically inserted here by JS -->
                </div>
                <div class="button-group">
                    <button id="show-suspects-button" class="big-btn">View Suspects</button>
                    <button id="show-objects-button" class="big-btn">View Objects</button>
                </div>
                <div class="button-group">
                    <button id="show-cypher-button" class="big-btn secondary" style="display: none;">View Cypher</button>
                    <button id="notebook-button" class="big-btn secondary">Notebook</button>
                    <button id="recap-button" class="big-btn secondary">Recap Clue</button>
                </div>
            </div>

            <!-- Container for the grid selection, now integrated into the task screen -->
            <div id="selection-container">
                <h2 id="grid-title" class="title">Choose</h2>
                <div id="grid-content" class="grid"></div>
                <div id="selection-feedback">Select one item as your answer.</div>
                <div class="button-group">
                    <button id="confirm-selection-button" class="big-btn">Confirm Selection</button>
                    <button id="close-grid-button" class="big-btn secondary">Back to Clue</button>
                </div>
            </div>

            <!-- NEW: Container for the notebook view -->
            <div id="notebook-view">
                <h2 class="title">Detective's Notebook</h2>
                <h3 class="screen-subheader header-clue">Suspects</h3>
                <div id="notebook-suspects-grid" class="grid"></div>
                <h3 class="screen-subheader header-clue">Objects</h3>
                <div id="notebook-objects-grid" class="grid"></div>
                <button id="notebook-close-button" class="big-btn secondary">Back to Clue</button>
            </div>

            <!-- NEW: Container for the cypher view -->
            <div id="cypher-view">
                <h2 class="title">Cypher</h2>
                <img id="cypher-img" src="" alt="Cypher Image" class="screen-image">
                <button id="cypher-close-button" class="big-btn secondary">Back to Clue</button>
            </div>

            <!-- Container for feedback, also integrated -->
            <div id="feedback-container">
                <h2 id="feedback-title" class="title">Result</h2>
                <div id="feedback-narrative"></div>
                <button id="feedback-continue-button" class="big-btn">See Progress</button>
            </div>
        </div>

        <!-- Progress Screen -->
        <div id="progress-screen" class="screen">
            <div class="title">Investigation Progress</div>
            <img src="detective-chart.png" alt="Detective Chart" class="screen-image" style="width: 100%; max-width: 350px;">
            <div style="display: flex; width: 100%; align-items: center; justify-content: center; gap: 1rem; margin-bottom: 1rem;">
                <div id="correctness-graphic" class="progress-graphic-container">
                    <svg class="progress-ring" width="120" height="120">
                        <circle class="progress-ring__circle-bg" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" />
                        <circle class="progress-ring__circle" id="correctness-circle" stroke-width="8" fill="transparent" r="52" cx="60" cy="60" />
                    </svg>
                    <span id="correctness-percentage" class="progress-percentage-text">0%</span>
                    <span class="progress-label-text">Correct</span>
                </div>
                <p id="progress-message" style="margin: 0; text-align: left; flex: 1;">Here's how you're tracking so far.</p>
            </div>
            <div id="milestones-container">
                <div class="milestone" id="milestone-25">🕵️</div>
                <div class="milestone" id="milestone-50">🔍</div>
                <div class="milestone" id="milestone-75">🔓</div>
                <div class="milestone" id="milestone-100">🎉</div>
                <div id="progress-bar-container">
                    <div id="progress-bar">0%</div>
                </div>
            </div>
            <div id="progress-summary"></div>
            <div id="motivational-quote-container"></div>
            <button id="progress-continue-button" class="big-btn">Next Clue</button>
        </div>

        <!-- Grand Reveal Screen -->
        <div id="grand-reveal-screen" class="screen">
            <div class="title">The Grand Reveal!</div>
            <img src="grand-reveal.png" alt="Grand Reveal" class="screen-image">
            <div id="reveal-story-content" style="width:100%"></div>
            <div id="grand-reveal-container">
                <div class="culprit-display">
                    <h3>The Thief</h3>
                    <img id="culprit-img" src="" alt="Culprit">
                    <p id="culprit-name"></p>
                </div>
                <div class="culprit-display">
                    <h3>Used to Steal The Apple</h3>
                    <img id="used-object-img" src="" alt="Used Object">
                    <p id="used-object-name"></p>
                </div>
            </div>
            <button id="reveal-continue-button" class="big-btn">See Your Award</button>
        </div>

        <!-- Detective Award Screen -->
        <div id="detective-award-screen" class="screen">
            <div class="title">Detective Award</div>
            <img id="award-badge-img" src="" alt="Detective Badge" class="screen-image" style="width: 100%; max-width: 100%;">
            <h2 id="award-title-text" class="subtitle" style="margin-top: 10px; margin-bottom: 10px;"></h2>
            <div id="score-breakdown">
                <p><span>Correct Answers:</span> <span id="base-score">0</span></p>
                <p><span>Error Penalty:</span> <span id="error-penalty">0</span></p>
                <p id="final-score-line"><span>Final Score:</span> <span id="final-score">0</span></p>
            </div>
            <div id="award-dialogue-container" style="width: 100%;">
                <!-- Dialogue will be inserted here -->
            </div>
            <div class="button-group">
                <button id="view-certificate-button" class="big-btn">View Certificate</button>
                <button id="play-again-button" class="big-btn">Play Again?</button>
            </div>
        </div>

        <!-- NEW: Certificate Screen -->
        <div id="certificate-screen" class="screen">
            <div id="certificate-content">
                <h1>Certificate of Achievement</h1>
                <p>This certificate is proudly awarded to</p>
                <h2 id="certificate-player-name"></h2>
                <p>for successfully solving The Garden Heist and earning the prestigious rank of</p>
                <h3 id="certificate-rank"></h3>
                <div class="certificate-signature-container">
                    <div class="certificate-signature"><img src="moo.png" alt="Moo"></div>
                    <div class="certificate-signature"><img src="hazel.png" alt="Hazel"></div>
                </div>
            </div>
            <div class="button-group no-print">
                <button id="print-certificate-button" class="big-btn">Print / Save as PDF</button>
                <button id="certificate-back-button" class="big-btn secondary">Back</button>
            </div>
            <p class="no-print" style="font-size: 0.8em; margin-top: 10px;">(Hint: In the print dialog, you can choose 'Save as PDF' from the destination list.)</p>
        </div>
    </div>

    <!-- The popup for showing the recap -->
    <div id="recap-modal" class="popup-overlay">
        <div class="popup-content">
            <h2 id="recap-title" class="title">Clue Recap</h2>
            <div id="recap-content"></div>
            <button id="recap-close-button" class="big-btn secondary">Close</button>
        </div>
    </div>

    <!-- Template for Grid Items -->
    <template id="grid-item-template">
        <div class="grid-item">
            <img src="" alt="">
            <p></p>
        </div>
    </template>

    <div id="preload-cache" style="display: none;"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ELEMENTS ---
            const elements = {
                screens: {
                    loading: document.getElementById('loading-screen'),
                    welcome: document.getElementById('welcome-screen'),
                    story: document.getElementById('story-screen'),
                    introStory: document.getElementById('intro-story-screen'),
                    cluePopup: document.getElementById('clue-popup-screen'),
                    directions: document.getElementById('directions-screen'),
                    clueStory: document.getElementById('clue-story-screen'),
                    task: document.getElementById('task-screen'),
                    progress: document.getElementById('progress-screen'),
                    grandReveal: document.getElementById('grand-reveal-screen'),
                    detectiveAward: document.getElementById('detective-award-screen'),
                    certificate: document.getElementById('certificate-screen'),
                },
                buttons: {
                    start: document.getElementById('start-button'),
                    storyContinue: document.getElementById('story-continue-button'),
                    introStoryNext: document.getElementById('intro-story-next-button'),
                    directionsNext: document.getElementById('directions-next-button'),
                    clueStorySolve: document.getElementById('clue-story-solve-button'),
                    showSuspects: document.getElementById('show-suspects-button'),
                    showObjects: document.getElementById('show-objects-button'),
                    confirmSelection: document.getElementById('confirm-selection-button'),
                    closeGrid: document.getElementById('close-grid-button'),
                    feedbackContinue: document.getElementById('feedback-continue-button'),
                    progressContinue: document.getElementById('progress-continue-button'),
                    recap: document.getElementById('recap-button'),
                    recapClose: document.getElementById('recap-close-button'),
                    revealContinue: document.getElementById('reveal-continue-button'),
                    playAgain: document.getElementById('play-again-button'),
                    showCypher: document.getElementById('show-cypher-button'),
                    cypherClose: document.getElementById('cypher-close-button'),
                    notebook: document.getElementById('notebook-button'),
                    notebookClose: document.getElementById('notebook-close-button'),
                    viewCertificate: document.getElementById('view-certificate-button'),
                    printCertificate: document.getElementById('print-certificate-button'),
                    certificateBack: document.getElementById('certificate-back-button'),
                },
                inputs: {
                    detectiveName: document.getElementById('detectiveName'),
                },
                loading: {
                    progressBar: document.getElementById('loading-progress-bar'),
                },
                dynamicContent: {
                    cluePopupTitle: document.getElementById('clue-popup-title'),
                    taskSubtitle: document.getElementById('task-subtitle'),
                    taskDialogueContainer: document.getElementById('task-dialogue-container'),
                    progressBar: document.getElementById('progress-bar'),
                    progressMessage: document.getElementById('progress-message'),
                    progressSummary: document.getElementById('progress-summary'),
                    motivationalQuoteContainer: document.getElementById('motivational-quote-container'),
                    directionsSubtitle: document.getElementById('directions-subtitle'),
                    directionsArrowsContainer: document.getElementById('directions-arrows-container'),
                    directionsContent: document.getElementById('directions-content'),
                    clueStorySubtitle: document.getElementById('clue-story-subtitle'),
                    clueStoryContent: document.getElementById('clue-story-content'),
                    storyScreenContent: document.getElementById('story-screen-content'),
                    introStoryContent: document.getElementById('intro-story-content'),
                    correctnessGraphic: document.getElementById('correctness-graphic'),
                    correctnessCircle: document.getElementById('correctness-circle'),
                    correctnessPercentage: document.getElementById('correctness-percentage'),
                    timerDisplay: document.getElementById('timer-display'),
                    progressIndicators: {
                        directions: document.getElementById('directions-progress'),
                        clueStory: document.getElementById('clue-story-progress'),
                        task: document.getElementById('task-progress'),
                    },
                    milestones: {
                        25: document.getElementById('milestone-25'),
                        50: document.getElementById('milestone-50'),
                        75: document.getElementById('milestone-75'),
                        100: document.getElementById('milestone-100'),
                    }
                },
                taskScreenViews: {
                    main: document.getElementById('task-main-view'),
                    selection: document.getElementById('selection-container'),
                    feedback: document.getElementById('feedback-container'),
                    notebook: document.getElementById('notebook-view'),
                    cypher: document.getElementById('cypher-view'),
                },
                selectionGrid: {
                    title: document.getElementById('grid-title'),
                    content: document.getElementById('grid-content'),
                    feedback: document.getElementById('selection-feedback'),
                },
                feedbackView: {
                    title: document.getElementById('feedback-title'),
                    narrative: document.getElementById('feedback-narrative'),
                },
                recapModal: {
                    container: document.getElementById('recap-modal'),
                    title: document.getElementById('recap-title'),
                    content: document.getElementById('recap-content'),
                },
                cypherView: {
                    img: document.getElementById('cypher-img'),
                },
                notebookView: {
                    suspectsGrid: document.getElementById('notebook-suspects-grid'),
                    objectsGrid: document.getElementById('notebook-objects-grid'),
                },
                reveal: {
                    culpritImg: document.getElementById('culprit-img'),
                    culpritName: document.getElementById('culprit-name'),
                    usedObjectImg: document.getElementById('used-object-img'),
                    usedObjectName: document.getElementById('used-object-name'),
                    storyContent: document.getElementById('reveal-story-content'),
                },
                award: {
                    badgeImg: document.getElementById('award-badge-img'),
                    titleText: document.getElementById('award-title-text'),
                    baseScore: document.getElementById('base-score'),
                    errorPenalty: document.getElementById('error-penalty'),
                    finalScore: document.getElementById('final-score'),
                    dialogueContainer: document.getElementById('award-dialogue-container'),
                },
                certificate: {
                    playerName: document.getElementById('certificate-player-name'),
                    rank: document.getElementById('certificate-rank'),
                },
                templates: {
                    gridItem: document.getElementById('grid-item-template'),
                }
            };

            

            // --- GAME STATE ---
const gameState = {
    detectiveName: '',
    currentScreen: 'loading',
    currentClueIndex: 0,
    correctAnswers: 0,
    incorrectGuesses: 0,
    finalScore: 0,
    finalRank: '',
    playerSelection: null,
    eliminatedSuspects: [],
    eliminatedObjects: [],
    progressBarInterval: null,
    correctnessAnimationInterval: null
};

// --- SAVE GAME STATE ---
function saveGameState() {
  try {
    const stateToSave = {
      currentScreen: gameState.currentScreen,
      currentClueIndex: gameState.currentClueIndex,
      correctAnswers: gameState.correctAnswers,
      incorrectGuesses: gameState.incorrectGuesses,
      finalScore: gameState.finalScore,
      finalRank: gameState.finalRank,
      playerSelection: gameState.playerSelection,
      eliminatedSuspects: gameState.eliminatedSuspects,
      eliminatedObjects: gameState.eliminatedObjects,
      detectiveName: gameState.detectiveName
    };
    localStorage.setItem('gardenHeistProgress', JSON.stringify(stateToSave));
  } catch (e) {
    console.error("Failed to save game state", e);
  }
}


// --- LOAD SAVED GAME STATE IF EXISTS ---
    function init() {
                // First, always show the loading screen
                navigateTo('loading');

                // Preload all assets, and only when done, decide which screen to show next
                preloadAssets(() => {
                    const saved = localStorage.getItem('gardenHeistProgress');
                    if (saved) {
                        try {
                            const savedState = JSON.parse(saved);
                            Object.assign(gameState, savedState);
                            // Navigate to the screen from the save file
                            navigateTo(gameState.currentScreen || 'welcome');
                        } catch (e) {
                            console.warn("Couldn't load saved game. Starting fresh.", e);
                            // If the save file is corrupted, go to welcome
                            navigateTo('welcome');
                        }
                    } else {
                        // If no save file exists, go to welcome
                        navigateTo('welcome');
                    }
                });
            }
            
            // --- GAME DATA ---
            const gameData = {
                characters: [
                    { name: 'Moo', img: 'moo.png' },
                    { name: 'Hazel', img: 'hazel.png' },
                    { name: 'Barnaby Buttercup', img: 'badger.png' },
                    { name: 'Professor Gander', img: 'professor-gander.png' },
                    { name: 'Dr Mole', img: 'dr-mole.png' },
                    { name: 'Lord Roe', img: 'lord-roe.png' },
                    { name: 'Henrietta Hen', img: 'henrietta-hen.png' },
                    { name: 'Xavier the Ibex', img: 'xavier-the-ibex.png' },
                    { name: 'Algernon Hare', img: 'algernon-hare.png' },
                    { name: 'Lucy the Lemur', img: 'lucy-the-lemur.png' },
                    { name: 'Senor Toro', img: 'senor-toro.png' },
                    { name: 'Professor Draco', img: 'professor-draco.png' },
                    { name: 'Thomas Turkey', img: 'thomas-turkey.png' },
                    { name: 'Bertram Hedgehog', img: 'bertram-hedgehog.png' },
                    { name: 'Heckles the Laughing Hyena', img: 'heckles-the-laughing-hyena.png' },
                    { name: 'Jane Doe', img: 'jane-doe.png' },
                    { name: 'Willy Weasel', img: 'willy-weasel.png' },
                    { name: 'Al Badger', img: 'al-badger.png' },
                    { name: 'Felicity Fox', img: 'felicity-fox.png' }
                ],
                storyScreens: {
                    story: [
                        { type: 'dialogue', character: 'Moo', text: "Ah-ha! The third and finest member of our detective trio has arrived! Welcome, <span id=\"player-name-placeholder\">Detective</span> — your wit shall be our secret weapon!" },
                        { type: 'dialogue', character: 'Hazel', text: "Finally. Someone sensible. Let’s solve this before Moo tries to interrogate the hedges again." },
                        { type: 'dialogue', character: 'Barnaby Buttercup', text: "Oh, thank you, thank you! Together, you might just save the Fête… and my reputation as a gardener who doesn’t lose priceless fruit!" },
                        { type: 'dialogue', character: 'Moo', text: "Onward! The Golden Apple awaits — and so does my next dramatic monologue!" },
                    ],
                    introStory: [
                        { type: 'story', text: "The grand entrance to Wentworth Castle Gardens rises before you, stone pillars standing like ancient sentinels. A fine mist clings to the morning air, making the sprawling lawns glitter. Beside you, Moo strikes a pose, his detective’s trench coat flapping dramatically around his teddy-cow frame." },
                        { type: 'dialogue', character: 'Moo', text: "A classic country house caper!” he booms, startling a nearby robin. “The culprit will rue the day they crossed paths with Moo—and my astonishing powers of moo-duction!" },
                        { type: 'story', text: "Hazel, the red merle Border Collie, simply rolls her eyes, her gaze already sweeping the path ahead. She gives you a knowing look, a silent greeting that says, ‘Glad you’re here. I’m going to need backup.’" },
                        { type: 'story', text: "A frantic-looking badger in a waistcoat, clutching a ludicrously small watering can, scurries towards you." },
                        { type: 'dialogue', character: 'Barnaby Buttercup', text: "Detectives! Thank goodness! I’m Barnaby Buttercup, the Head Gardener,” he squeaks, wringing his paws. “It’s gone! The Golden Apple of Wentworth! Vanished! The Fête will be a disaster of bad knock-knock jokes without it!" },
                        { type: 'story', text: "He hands you a long, rolled-up piece of parchment. It’s your list of suspects and the peculiar objects one of them might have used. You nod grimly, taking the list. The game, as Moo would say, is officially a-hoof." },
                    ],
                    revealStory: [
                        { type: 'dialogue', character: 'Moo', text: "Bravo, detective! You've cornered our fruity felon! I knew it all along, of course. My methods are... unconventional." },
                        { type: 'dialogue', character: 'Hazel', text: "Your methods involved accusing a scarecrow. *Their* methods involved logic. Well done." },
                    ]
                },
                suspects: [
                    { name: 'Professor Gander', img: 'professor-gander.png' },
                    { name: 'Dr Mole', img: 'dr-mole.png' },
                    { name: 'Lord Roe', img: 'lord-roe.png' },
                    { name: 'Henrietta Hen', img: 'henrietta-hen.png' },
                    { name: 'Xavier the Ibex', img: 'xavier-the-ibex.png' },
                    { name: 'Algernon Hare', img: 'algernon-hare.png' },
                    { name: 'Lucy the Lemur', img: 'lucy-the-lemur.png' },
                    { name: 'Senor Toro', img: 'senor-toro.png' },
                    { name: 'Professor Draco', img: 'professor-draco.png' },
                    { name: 'Thomas Turkey', img: 'thomas-turkey.png' },
                    { name: 'Bertram Hedgehog', img: 'bertram-hedgehog.png' },
                    { name: 'Heckles the Laughing Hyena', img: 'heckles-the-laughing-hyena.png' },
                    { name: 'Jane Doe', img: 'jane-doe.png' },
                    { name: 'Willy Weasel', img: 'willy-weasel.png' },
                    { name: 'Al Badger', img: 'al-badger.png' },
                    { name: 'Felicity Fox', img: 'felicity-fox.png' }
                ],
                objects: [
                    { name: 'Rusty Key', img: 'rusty-key.png' },
                    { name: 'Squeaky bike pump', img: 'squeaky-bike-pump.png' },
                    { name: 'Magnifying Glass', img: 'magnifying-glass.png' },
                    { name: 'Pair of dice', img: 'pair-of-dice.png' },
                    { name: 'Bottle of lemonade', img: 'bottle-of-lemonade.png' },
                    { name: 'Leaky Hose', img: 'leaky-hose.png' },
                    { name: 'Teacup', img: 'teacup.png' },
                    { name: 'Bag of Birdseed', img: 'bag-of-birdseed.png' },
                    { name: 'Wooly Scarf', img: 'wooly-scarf.png' },
                    { name: 'Bow and Arrow', img: 'bow-and-arrow.png' },
                    { name: 'Wooden Bench', img: 'wooden-bench.png' },
                    { name: 'Flask of Tea', img: 'flask-of-tea.png' },
                    { name: 'A Signal Flag', img: 'a-signal-flag.png' },
                    { name: 'Pair of Slippers', img: 'pair-of-slippers.png' },
                ],
                clues: [
                    {
                        title: "The Board of Beginnings",
                        subtitle: "Clue #1",
                        cypherImage: '',
                        directions: [
                            { type: 'story', text: "You stride purposefully out of the car park, your detective senses tingling. The ticket office looms, a gateway to the mystery ahead." },
                            { type: 'dialogue', character: 'Moo', text: "This way, team! A true detective follows their gut, and my gut says the culprit went... that-a-way!" },
                            { type: 'dialogue', character: 'Hazel', text: "The gut is often mistaken. Let’s start with the official welcome." },
                            { type: 'story', text: "Following her lead, you pass through the entrance, turn right and spot a large, green information board. The perfect place to gather your wits." },
                        ],
                        directionsImages: ['straight-arrow.png', 'right-turn.png', 'straight-arrow.png', 'stop.png'],
                        clueStory: [
                            { type: 'dialogue', character: 'Moo', text: "Right then! First, we check for giant footprints. Or dropped monocles. Or... or a hastily discarded top hat! The calling cards of a master criminal!" },
                            { type: 'dialogue', character: 'Hazel', text: "A smart investigation starts with understanding the territory, Moo. A thief needs a plan, and every plan starts with a map." },
                            { type: 'story', text: "She turns to you, her expression serious but encouraging." },
                            { type: 'dialogue', character: 'Hazel', text: "The answer we need first won’t be the solution to the whole case, but it will help us unlock it."}
                        ],
                        task: {
                            character: 'Hazel',
                            text: "Every map has a part that explains what all the symbols mean. On this board, that part is labeled with a three-letter word. It’s something you might use to open a door, but here, it opens up the map for you. What is that three-letter word?"
                        },
                        type: 'object',
                        answer: 'Rusty Key',
                        correctAnswerReason: [
                            { type: 'story', text: "You spot the word and point it out." },
                            { type: 'dialogue', character: 'Moo', text: "A-HA! The KEY! It’s the key to the whole puzzle! They must have used a rusty old key to pick the lock on the Golden Apple’s display case. Elementary, my dear Hazel!" },
                            { type: 'dialogue', character: 'Hazel', text: "Look closer, Moo. That word isn’t describing a physical object for opening a lock. It’s a guide for understanding the map’s symbols. A thief wouldn’t use a glossary to steal a magical apple." },
                            { type: 'story', text: "With a newfound sense of clarity, you cross A Rusty Key off your list of suspicious objects." }
                        ],
                        wrongAnswerReason: [
                            { type: 'dialogue', character: 'Hazel', text: "Not quite. While that’s a good guess, the clue points to the three-letter word on the map board that explains the symbols. That word is ‘KEY’. So, we can eliminate the Rusty Key from our list of objects." }
                        ],
                        motivationalQuote: { character: 'Moo', text: "A brilliant start! The case is practically solving itself with you on the team!" }
                    },
                    {
                        title: "Puzzling Post",
                        subtitle: "Clue #2",
                        cypherImage: '',
                        directions: [
                             { type: 'story', text: "Leaving the information board behind, you lead your team along the wide, sweeping path. The fields of Wentworth stretch out to your right, a patchwork of green and gold." },
                             { type: 'dialogue', character: 'Moo', text: "Just as I suspected. The path is... path-shaped. A classic diversionary tactic! But they can’t fool me." },
                             { type: 'story', text: "The path curves gently, and ahead, you see it – a tall, wooden signpost standing at a crossroads." },
                             { type: 'dialogue', character: 'Hazel', text: "A good detective reads the signs, Moo. Especially the literal ones." },
                        ],
                        directionsImages: ['straight-arrow.png', 'left-turn.png', 'straight-arrow.png', 'stop.png'],
                        clueStory: [
                            { type: 'story', text: "You gather around the signpost, its four arms pointing to different destinations." },
                            { type: 'dialogue', character: 'Moo', text: "The thief must have gone to the... uh... Café! For a post-heist espresso! Or the Play Area! To... play! It’s all so clear!" },
                            { type: 'dialogue', character: 'Hazel', text: "Or they left us a message. A clever thief loves to show off, but sometimes their cleverness can be their undoing. I think one of our suspects got their own name in a twist." },
                        ],
                        task: {
                            character: 'Hazel',
                            text: "Our thief is a lover of nature, but also famously mixed-up. Look for the sign that points towards the place of plants, ponds, and flowers. The letters of that single word are all jumbled up! Unscramble them to reveal the last name of a very flustered, feathered suspect on your list."
                        },
                        type: 'suspect',
                        answer: 'Professor Gander',
                        correctAnswerReason: [
                            { type: 'story', text: "You whisper the unscrambled name to your partners." },
                            { type: 'dialogue', character: 'Moo', text: "Ganders! Professor Ganders! He's taunting us with his own name! The fiend is so arrogant, he practically signed his work! This is a confession!" },
                            { type: 'dialogue', character: 'Hazel', text: "On the contrary. Professor Ganders is a renowned intellectual, obsessed with his own brilliance. Would a creature so proud of his own mind really leave his name behind as a messy, jumbled anagram? It’s far too clumsy for his ego. He’d see it as an insult to his intelligence." },
                            { type: 'story', text: "You nod in agreement. A suspect that vain would never be so careless. You confidently strike Professor Ganders off the list." }
                        ],
                        wrongAnswerReason: [
                            { type: 'dialogue', character: 'Hazel', text: "Close, but not quite. The jumbled word on the sign for the gardens unscrambles to GANDER. That means we can safely eliminate Professor Gander from our list of suspects." }
                        ],
                        motivationalQuote: { character: 'Hazel', text: "Good work. Every elimination gets us one step closer to the truth." }
                    },
                    {
                        title: "The Inventor's Inspiration",
                        subtitle: "Clue #3",
                        cypherImage: '',
                        directions: [
                            { type: 'story', text: "You check the signpost again, then lead your team in the direction indicated for hot drinks and tasty snacks. Moo’s tummy rumbles loudly." },
                            { type: 'dialogue', character: 'Moo', text: "An excellent choice, Junior Detective! The criminal mind is often fueled by cake. By investigating their potential source of Victoria Sponge, we are, in fact, getting one step ahead!" },
                            { type: 'dialogue', character: 'Hazel', text: "Focus, Moo. We’re not here for elevenses." },
                            { type: 'story', text: "A faint, delicious scent of baking drifts on the breeze. As you approach the building where people are sitting with cups and saucers, you spot it: a round, blue plaque fixed to the stone wall, commemorating a great mind from the past." }
                        ],
                        directionsImages: ['right-turn.png', 'straight-arrow.png'],
                        clueStory: [
                            { type: 'story', text: "You check the signpost again, then lead your team in the direction indicated for hot drinks and tasty snacks. Moo’s tummy rumbles loudly." },
                            { type: 'dialogue', character: 'Moo', text: "An excellent choice, Junior Detective! The criminal mind is often fueled by cake. By investigating their potential source of Victoria Sponge, we are, in fact, getting one step ahead!" },
                            { type: 'dialogue', character: 'Hazel', text: "Focus, Moo. We’re not here for elevenses." },
                            { type: 'story', text: "As you approach the building where people are sitting with cups and saucers, you spot it: a round, blue plaque fixed to the stone wall, commemorating a great mind from the past." }
                        ],
                        task: {
                            character: 'Hazel',
                            text: "Hazel taps her tail against the stone wall, her eyes scanning the blue circle. \"This plaque lists many of the man's creations. Read it carefully. You are looking for a four-letter word for a device that moves liquid or air. Find that specific word, and you will find an object on your list that you can eliminate.\""
                        },
                        type: 'object',
                        answer: 'Squeaky bike pump',
                        correctAnswerReason: [
                            { type: 'story', text: "You find the word and point it out to your partners." },
                            { type: 'dialogue', character: 'Moo', text: "The PUMP! Of course! The thief needed to quietly inflate a decoy to distract the guards! They must have used a bicycle pump! It’s brilliant in its simplicity!" },
                            { type: 'dialogue', character: 'Hazel', text: "But is it, though? The inventor here used this device for powerful, industrial things. Our thief is trying to steal a priceless magical artifact. Do you really think they’d risk the entire operation by using something as clumsy and noisy as a squeaky bicycle pump? It’s far too low-tech for such a high-stakes heist." },
                            { type: 'story', text: "Moo deflates a little, and you confidently score A Squeaky Bicycle Pump off your list." }
                        ],
                        wrongAnswerReason: [
                            { type: 'story', text: "You point at the plaque with a grin, but Hazel tilts her head, unimpressed." },
                            { type: 'dialogue', character: 'Hazel', text: "Hmm. Not quite. Look closer — PUMP. A four-letter device that moves liquid or air. It’s right here!" },
                            { type: 'story', text: "She sits back with a wag of her tail." },
                            { type: 'dialogue', character: 'Hazel', text: "Smart thieves wouldn’t use a squeaky bicycle pump for a grand heist. Too clumsy. Too noisy. That’s why we can cross it off!" },
                            { type: 'story', text: "You nod, scribbling A Squeaky Bicycle Pump off the list as Moo beams proudly anyway." }
                        ],
                        motivationalQuote: { character: 'Moo', text: "Every great detective knows — sometimes you have to pump the brakes before you find the real trail!" }
                    },

{
    "title": "A Healthy Deduction",
    "subtitle": "Clue #4",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You don't have to move far. Nearby the inventor's plaque is another, celebrating a different kind of pioneer. Moo is still muttering about beer pumps and bicycles." },
        { "type": "dialogue", "character": "Moo", "text": "Honestly, Hazel... The criminal mind is so dreadfully common sometimes." },
        { "type": "dialogue", "character": "Hazel", "text": "Don’t be so sure. True genius is often found where you least expect it. And so are clues." },
        { "type": "story", "text": "You step closer to the plaque dedicated to the famous biologist and pioneer of medicine." }
    ],
    "directionsImages": ["wait.png", "stop.png"],
    "clueStory": [
        { "type": "dialogue", "character": "Moo", "text": "Goodness me! She saved countless lives! A person like this has nothing to do with our crime." },
        { "type": "dialogue", "character": "Hazel", "text": "Not so fast. The woman herself is obviously a hero. But a devious suspect might hide their name in the words that honour her." },
        { "type": "story", "text": "Hazel leans in, reconsidering. 'My first assessment was hasty. A true detective re-examines the evidence.'" }
    ],
    "task": {
        "character": "Hazel",
        "text": "Follow these instructions to find a hidden name:\n\n1. Find the 12-letter word at the end of the main text that means 'celebrated'. Take its 3rd letter.\n2. Find the 11-letter treatment she introduced. Take its 2nd letter.\n3. Find the 7-letter scientific field at the top. Take its 4th letter.\n4. Find the 12-letter adjective before the word 'medicine'. Take its last letter.\nPut the four letters together to name the suspect."
    },
    "type": "suspect",
    "answer": "Dr Mole",
    "correctAnswerReason": [
        { "type": "story", "text": "You piece the letters together and whisper the suspect’s name." },
        { "type": "dialogue", "character": "Moo", "text": "Dr. Mole! The short-sighted scoundrel! He must be our thief!" },
        { "type": "dialogue", "character": "Hazel", "text": "He’s a creature of the dark. This plaque celebrates someone who brought ideas into the light. He’d never associate his name with that." },
        { "type": "story", "text": "You nod, seeing the mismatch. Dr. Mole is innocent. You cross him off the list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Let's look again. The instructions lead to the name M-O-L-E. That points to Dr. Mole on our list." },
{ "type": "dialogue", "character": "Moo", "text": "Dr. Mole! The short-sighted scoundrel! He must be our thief!" },
{ "type": "dialogue", "character": "Hazel", "text": "I don't think so. He’s a creature of the dark. This plaque celebrates someone who brought ideas into the light. He’d never associate his name with that. We can cross him off." }

    ],
    "motivationalQuote": { "character": "Moo", "text": "Your mind’s sharper than a hedgehog in a pin factory!" }
},

{
    "title": "The House of a Thousand Eyes",
    "subtitle": "Clue #5",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "With your back to the café building, you turn right and follow the path between hedges. It opens out into a formal garden with benches and beds." },
        { "type": "dialogue", "character": "Moo", "text": "Now that’s a seriously big house!" }
    ],
    "directionsImages": ["right-turn.png", "straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "dialogue", "character": "Moo", "text": "The Golden Apple must be in there! Let's storm the big fancy house!" },
        { "type": "story", "text": "He stumbles over a loose stone." },
        { "type": "dialogue", "character": "Hazel", "text": "Observe first. Look at that place. Sometimes what you see tells you what you don't need." }
    ],
    "task": {
        "character": "Hazel",
        "text": "This building is full of windows—eyes everywhere, letting light flood in. Which glass object on our list, normally used for looking closely at things, would be completely pointless here?"
    },
    "type": "object",
    "answer": "Magnifying Glass",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "Not my magnifying glass! It’s essential!" },
        { "type": "dialogue", "character": "Hazel", "text": "It’s essential for paw prints—but a thief here wouldn’t use one. There are already hundreds of windows to peer through." },
        { "type": "story", "text": "Moo polishes his now-cleared magnifying glass as you cross it off the list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Think about what the building already has plenty of—and what would be redundant for a thief." }
    ],
    "motivationalQuote": { "character": "Moo", "text": "You see what others miss—even with no glass involved!" }
},

{
    "title": "The Temple Cipher",
    "subtitle": "Clue #6",
    "cypherImage": "clue6cypher.png",
    "directions": [
        { "type": "story", "text": "You leave the grand house and walk toward the stone temple on the hill. Past the ha-ha, across a small bridge, your eyes fix on the impressive structure among the trees." },
        { "type": "dialogue", "character": "Moo", "text": "A-ha! A classic trap for the unwary cow!" }
    ],
    "directionsImages": ["straight-arrow.png", "right.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "You reach the temple. Moo taps the stone excitedly." },
        { "type": "dialogue", "character": "Moo", "text": "It’s a code! These stones are trying to tell me something!" },
        { "type": "dialogue", "character": "Hazel", "text": "This building is all steps and pillars. It’s the perfect cipher key." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Use the temple’s architecture to decode a name from the cipher grid:\n\n1. First letter: Number of steps = row, number of pillars = column.\n2. Second letter: Use number of steps for both row and column.\n3. Third letter: Pillars = row, steps = column.\n\nUse the card to spell the name of the suspect."
    },
    "type": "suspect",
    "answer": "Lord Roe",
    "correctAnswerReason": [
        { "type": "story", "text": "You decode the grid. The letters spell R-O-E." },
        { "type": "dialogue", "character": "Moo", "text": "Lord Roe! That nervous fellow who jumps at his own shadow!" },
        { "type": "dialogue", "character": "Hazel", "text": "Exactly. He’s too timid for a heist during the bustle of the fête. He’s innocent." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Make sure you're counting the temple’s steps and pillars correctly. Then follow the cipher instructions exactly." }
    ],
    "motivationalQuote": { "character": "Moo", "text": "You cracked the code! We’re one step closer to the apple!" }
},


{
    "title": "The Pillars of Calculation",
    "subtitle": "Clue #7",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You don't need to move an inch. Hazel simply turns around, and you and Moo follow suit. The view from the temple steps is magnificent, looking back across a huge, sloping lawn towards another side of the grand mansion." },
        { "type": "dialogue", "character": "Moo", "text": "Good heavens! It's just as big from this side! The sheer audacity! They could be hiding a hundred stolen apples in there!" },
        { "type": "dialogue", "character": "Hazel", "text": "Let's focus on what we can see. The answer is right in front of us." }
    ],
    "directionsImages": ["u-turn.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "You all stare across the lawn at the great house's impressive entrance. Its huge pillars support a triangular roof, making the entrance look like another grand temple." },
        { "type": "dialogue", "character": "Moo", "text": "If I take the number of windows and multiply by the height of the chimneys... carry the one... the culprit is... a badger!" },
        { "type": "dialogue", "character": "Hazel", "text": "It's simpler than that, Moo. The answer isn't in some complex equation. Our thief has a sense of drama. They've based their clue on the grandest part of the building to show how clever they are." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Count the number of tall, round pillars supporting the triangular roof at the main entrance.\n\nNow for the riddle: That number is the highest you’ll find on a standard version of one of the objects on our list—something often used in board games. What is the object?"
    },
    "type": "object",
    "answer": "A Pair of Dice",
    "correctAnswerReason": [
        { "type": "story", "text": "You count six pillars on the front portico." },
        { "type": "dialogue", "character": "Moo", "text": "A Pair of Dice! The thief is a gambler! They risked it all on one roll!" },
        { "type": "dialogue", "character": "Hazel", "text": "Quite the opposite. The theft was meticulous and calculated. This was about certainty, not chance." },
        { "type": "story", "text": "You agree—this crime wasn’t a gamble. You confidently cross A Pair of Dice off your object list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Close, but think about the number of pillars and what object on our list uses that number as its upper limit." }
    ],
    "motivationalQuote": { "character": "Moo", "text": "You’re rolling sixes today, detective!" }
},

{
    "title": "The Dozen Divisors",
    "subtitle": "Clue #8",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "With your back to the temple, you turn left and follow Hazel's lead. The path guides you into a more private, enclosed area, sheltered by high brick walls. It feels like a secret place." },
        { "type": "story", "text": "Directly ahead, a wide stone staircase invites you to climb upwards, deeper into the gardens." },
        { "type": "dialogue", "character": "Moo", "text": "Aha! An endurance challenge! The thief must have been very fit! This narrows it down to any suspect who owns a tracksuit!" },
        { "type": "dialogue", "character": "Hazel", "text": "It's not a race, Moo. It's a calculator." }
    ],
    "directionsImages": ["left-turn.png", "straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "The three of you stand at the bottom of the grand staircase. The stone is old and weathered, and the air is still." },
        { "type": "dialogue", "character": "Moo", "text": "I'm not a mountain goat, you know. I prefer my clues on level ground." },
        { "type": "dialogue", "character": "Hazel", "text": "Think of it as climbing the ladder of deduction. Every part of this place is a piece of the puzzle. The person who built this left us a number, and our thief is using it to point a finger at one of our suspects." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Carefully count how many stone risers make up this staircase, from the bottom path all the way to the top landing.\n\nThen solve this riddle: One of our suspects is famous for creating things that are traditionally sold in that exact number. Who is it?"
    },
    "type": "suspect",
    "answer": "Henrietta Hen",
    "correctAnswerReason": [
        { "type": "story", "text": "You finish counting the stairs—twelve in total—and think through the riddle." },
        { "type": "dialogue", "character": "Moo", "text": "Henrietta Hen! She was going to smuggle the Golden Apple out in a carton of a dozen eggs! A brilliant, if breakfast-based, plan!" },
        { "type": "dialogue", "character": "Hazel", "text": "Henrietta is too straightforward for this kind of elaborate game. These clues are the work of a show-off. That’s not her style." },
        { "type": "story", "text": "You nod, seeing the logic. You cross Henrietta Hen off your list of suspects." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "That’s a good try, but think again about the number of stairs and what’s usually sold in that exact number." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "That’s egg-cellent detective work, if I do say so myself!"
    }
},

{
    "title": "The Citrus Secret",
    "subtitle": "Clue #9",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the stone staircase behind you and walk straight ahead, towards the magnificent glass building. The promise of warmth and exotic plants welcomes you." },
        { "type": "dialogue", "character": "Moo", "text": "The Conservatory! An excellent choice, Junior Detective. A self-contained ecosystem, perfect for trapping a suspect! And for warming one's hooves." },
        { "type": "story", "text": "You push open the doors and are immediately greeted by a wave of warm, humid air, thick with the scent of damp earth and sweet flowers. Just inside, you spot a tall, glassy sign detailing the treasures of the plant world." }
    ],
    "directionsImages": ["straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "The conservatory is a jungle of enormous leaves and strange, beautiful flowers." },
        { "type": "dialogue", "character": "Moo", "text": "Phew! It's a bit close in here. A master of disguise could be hiding behind any one of these giant ferns!" },
        { "type": "dialogue", "character": "Hazel", "text": "A thief might hide, but facts cannot. This sign tells us where many things we see every day originally came from. And I think it will also tell us about an object our particularly tidy thief would never have carried." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Look closely at the 'Did you know?' section at the bottom of the sign beside the picture of a fruit.\n\nIt lists three citrus fruits that originated in Asia. Which one is sour, yellow, and oval-shaped?\n\nFind that seven-letter word on the sign, and you'll identify an object to cross off your list."
    },
    "type": "object",
    "answer": "A Bottle of Lemonade",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "Lemons! Which means... lemonade! The culprit must have packed a refreshing beverage! A classic rookie mistake!" },
        { "type": "dialogue", "character": "Hazel", "text": "On the contrary. Our thief is neat and careful. Carrying sticky, sugary liquid would be far too risky. One spill and they’d leave a trail of evidence." },
        { "type": "story", "text": "You agree—no professional thief would risk such a messy mistake. You strike A Bottle of Lemonade from the list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Check the 'Did you know?' section again. We're looking for a specific fruit—sour, yellow, and oval." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "Zesty thinking, partner! You’ve got a real taste for this!"
    }
},

{
    "title": "The Century",
    "subtitle": "Clue #10",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "Remain in the lush garden where the last clue left you. Moo has wandered toward a striking figure in the foliage: a kneeling man holding what Moo insists is 'a very fancy fruit bowl.'" },
        { "type": "dialogue", "character": "Hazel", "text": "That’s not for fruit, Moo. It’s a sundial." },
        { "type": "story", "text": "You follow, weaving through the greenery toward the small information sign by the statue’s base." }
    ],
    "directionsImages": ["wait.png"],
    "clueStory": [
        { "type": "story", "text": "Moo crouches next to the figure, eyes wide." },
        { "type": "dialogue", "character": "Moo", "text": "Clearly this is a clue! A mysterious figure kneeling before us, holding… the sun itself? What sorcery is this? Maybe he’s pointing to the real thief?" },
        { "type": "dialogue", "character": "Hazel", "text": "No magic, Moo. Just history. The answer we’re looking for is right there. And it’s not in the figure — it’s in the century he was cast. Watch closely, junior detective. Let’s turn that century into a code." }
    ],
    "task": {
        "character": "Hazel",
        "text": "On the plaque, find the century in which this lead cast was made.\nConvert that century into Roman numerals.\nThose letters form the initials of a suspect who is clearly too busy being ancient to be guilty."
    },
    "type": "suspect",
    "answer": "Xavier the Ibex",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Player", "text": "XVIII — Xavier the Vexed Ibex Incognito! He must be the thief!" },
        { "type": "dialogue", "character": "Moo", "text": "Of course! A vexed, secretive ibex with a fondness for old statues!" },
        { "type": "dialogue", "character": "Hazel", "text": "Unlikely. Xavier’s too busy penning angry letters to the editor about the decline of classical architecture. And have you ever seen an ibex sneak through a building without knocking over potted plants? No, our thief was far more graceful." },
        { "type": "story", "text": "You agree and strike Xavier the Ibex from the suspect list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look — the figure was made in the 18th century. In Roman numerals, that’s XVIII. Those letters match the initials of our suspect: Xavier the Vexed Ibex Incognito. But Xavier’s far too clumsy for this crime. Cross him off!" }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "XVIII points to victory! Nice work!"
    }
},

{
    "title": "The Weight of Evidence",
    "subtitle": "Clue #11",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You wave goodbye to the lush greenery of the conservatory and exit through the door on the opposite side from where you entered. The door leads you into a smaller, quieter side room full of more interesting exhibits." },
        { "type": "dialogue", "character": "Moo", "text": "A-ha, a secret room! The perfect place for a clandestine meeting! Or a... a clandestine fact about seeds!" },
        { "type": "story", "text": "Hazel's sharp eyes have already found your next clue: a small, pale yellow sign mounted near a display. She trots over, waiting for you and Moo to catch up." }
    ],
    "directionsImages": ["straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "The three of you gather around the 'Seed Facts' sign." },
        { "type": "dialogue", "character": "Moo", "text": "18 kilograms! That's an astonishingly specific number. Criminals are often very specific. It's a well-known fact. I read it in a book once." },
        { "type": "dialogue", "character": "Hazel", "text": "It is a very specific number. And I don't think it's a coincidence. The thief isn't just showing off their knowledge of giant seeds; they're giving us a numerical code. Let's see if we can crack it." }
    ],
    "task": {
        "character": "Hazel",
        "text": "First, read the sign and find the maximum weight of the giant seed in kilograms (kg). You will get a two-digit number.\n\nNow, convert those two digits into letters using this simple code: A=1, B=2, C=3 and so on.\n\nThis will give you the two initials of our next suspect. Check your list for the only suspect who matches."
    },
    "type": "suspect",
    "answer": "Algernon Hare",
    "correctAnswerReason": [
        { "type": "story", "text": "You work out the initials and identify the matching suspect on your list." },
        { "type": "dialogue", "character": "Moo", "text": "Algernon Hare! He's fast! He could have been in and out with the Golden Apple before anyone even noticed!" },
        { "type": "dialogue", "character": "Hazel", "text": "He's fast, but is he a mathematician? This clue was a precise, multi-step numerical code. Algernon is a dear friend, but he can't remember where he buried his own carrots. This is too clever for him." },
        { "type": "story", "text": "You agree. The clue doesn’t match Algernon's personality. You cross him off the suspect list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look here — the seed weighs 18. Turn those numbers into letters — 1 is A, 8 is H — and you get A. H. That’s Algernon Hare. But this clue was far too organised for him. Cross him off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "That clue was cracking! Just like a giant seed pod!"
    }
},


{
    "title": "The Code",
    "subtitle": "Clue #12",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You are still in the quiet side room off the conservatory. Moo is looking around for more seed facts, but Hazel's attention has already been drawn to a sturdy-looking green door set into the stone wall." },
        { "type": "dialogue", "character": "Moo", "text": "A locked door is a mystery in itself! What secrets lie behind it? A forgotten map? A hidden treasure? A packed lunch?" },
        { "type": "dialogue", "character": "Hazel", "text": "The secret isn't behind the door, Moo. It's written right on it." }
    ],
    "directionsImages": ["wait.png"],
    "clueStory": [
        { "type": "story", "text": "The three of you read the sign above the door." },
        { "type": "dialogue", "character": "Moo", "text": "The 'Old' office for that job title! Our client, Barnaby Buttercup, has the same job now! Does he have a rival? A grumpy, retired character with a grudge? This changes everything!" },
        { "type": "dialogue", "character": "Hazel", "text": "It changes nothing, Moo, except to give us a clue. The sign is a four-word code. Our thief wants us to read it not for its meaning, but for its letters. It's time to do some code-breaking." }
    ],
    "task": {
        "character": "Hazel",
        "text": "To find the four-letter object we need to eliminate, take one letter from each of the four words on the sign. Follow these instructions exactly:\n\n1. First letter of the second word.\n2. First letter of the first word.\n3. Last letter of the third word.\n4. Last letter of the fourth word.\n\nPut those four letters together to form the object’s name."
    },
    "type": "object",
    "answer": "Leaky Hose",
    "correctAnswerReason": [
        { "type": "story", "text": "You piece the letters together and spell out the word." },
        { "type": "dialogue", "character": "Moo", "text": "Hose! The thief must have used a garden hose to lasso the Golden Apple from a distance! Or to wash away their footprints! How clever!" },
        { "type": "dialogue", "character": "Hazel", "text": "Clever — if the theft had been outside. But it wasn’t. The Golden Apple was stolen indoors. A leaky hose would be clumsy and messy. Not the tool of a professional." },
        { "type": "story", "text": "You agree. It makes no sense for an indoor heist. You strike A Leaky Hose from your object list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Let’s check it together: First from the second word — H. First from the first — O. Last of the third — S. Last of the fourth — E. That spells HOSE. But no professional thief would use that indoors. Cross it off!" }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "You've cracked the code — no hose, no mess, no nonsense!"
    }
},

{
    "title": "The Legacy",
    "subtitle": "Clue #13",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You exit the building complex by the door opposite the one you used to enter, finding yourself near the toilets. Taking a moment to get your bearings, you follow Hazel's lead and keep to the right, following a path that soon transforms into a beautiful avenue, with a long, straight line of trees on either side." },
        { "type": "dialogue", "character": "Moo", "text": "My word! It's an honour guard! Of trees! They must know a master detective is approaching. Salute, my woody friends, salute!" },
        { "type": "story", "text": "Hazel ignores him, her nose to the ground, sniffing out the trail. 'The clue is this way,' she says, stopping near a low, wooden sign half-hidden in the leaves." }
    ],
    "directionsImages": ["straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "The three of you look at the simple sign that names the path." },
        { "type": "dialogue", "character": "Moo", "text": "A walk named after a lady! How romantic! I imagine she was a heartbroken aristocrat who would walk this very path with her pet peacock, composing sad poetry. Our thief must be a romantic, too!" },
        { "type": "dialogue", "character": "Hazel", "text": "Or they are just very lazy. Our thief has created complex ciphers and clever riddles so far. But maybe they've finally made a simple mistake and left a name in plain sight." }
    ],
    "task": {
        "character": "Hazel",
        "text": "The thief has been uncharacteristically lazy with this clue. It seems they've used a name written right on this sign for one of their accomplices.\n\nLook at the sign and find the four-letter woman's name that is part of the name of this walk."
    },
    "type": "suspect",
    "answer": "Lucy the Lemur",
    "correctAnswerReason": [
        { "type": "story", "text": "You easily find the name and tell your partners." },
        { "type": "dialogue", "character": "Moo", "text": "Lucy! She's so arrogant she left her own name as a calling card! It's an open-and-shut case! We've got her!" },
        { "type": "dialogue", "character": "Hazel", "text": "Have we? Our thief is a mastermind. They’ve given us ciphers, hidden words, complex riddles... and now this? A name just sitting on a sign? It’s too simple. It’s clumsy. It’s a trap. This isn't a clue—it’s a distraction. Lucy’s innocent." },
        { "type": "story", "text": "You agree. The clue is too easy to be genuine. You cross Lucy the Lemur off your suspect list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look — it’s LUCY. Four letters, right here on ‘Lady Lucy’s Walk.’ That’s the name our thief left for us to find. But come on, our thief is clever, sneaky, full of riddles. Leaving a name out in the open like this? Too sloppy. That’s why we cross off Lucy the Lemur." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "Another name falls like autumn leaves before your genius!"
    }
},


{
    "title": "The Connection",
    "subtitle": "Clue #14",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You continue your journey up the beautiful avenue of trees that is Lady Lucy's Walk. The path is gentle, but you feel a sense of accomplishment as you reach the top where the path meets others in an open area." },
        { "type": "dialogue", "character": "Moo", "text": "Huzzah! We have reached the summit! I feel wiser already. The air up here is thick with... clues!" },
        { "type": "dialogue", "character": "Hazel", "text": "The air is thick with pollen, Moo. The clue is over here." }
    ],
    "directionsImages": ["straight-arrow.png", "left-turn.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "You gather around the sign for the 'Rhododendron fortunei'." },
        { "type": "dialogue", "character": "Moo", "text": "What a magnificent flower! Such colour! Such poise! It is clearly innocent of all charges. You can tell by its petals." },
        { "type": "dialogue", "character": "Hazel", "text": "The plant isn't a suspect, Moo. But its history might tell us something. A good detective knows that everything comes from somewhere — and that place can be revealing." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Find the section on the sign titled 'Original home'. What is the five-letter name of the country listed there?\n\nIt shares its name with a type of delicate material, and will help you eliminate a very fragile object from your list."
    },
    "type": "object",
    "answer": "A Teacup",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "China! The thief must have taken a detour to the other side of the world! Or… a 'china' teacup! The culprit stopped for a calming cup of tea mid-heist!" },
        { "type": "dialogue", "character": "Hazel", "text": "Think about it. The Golden Apple is heavy and magical. A thief would need both hands. A fragile teacup would shatter — and leave evidence everywhere." },
        { "type": "story", "text": "You nod. No master thief would carry such a delicate item on a high-stakes job. You confidently strike A Teacup off your list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look closer — the answer’s CHINA. It’s under ‘Original home’, and hints at something delicate. A teacup is fragile and completely impractical for a heist. Cross it off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "Another piece falls into place — one less cup, one step closer to the truth!"
    }
},

{
    "title": "The Humble Clue",
    "subtitle": "Clue #15",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the plant sign behind, continuing along the path from the top of the tree-lined avenue. Following Hazel's expert guidance, you always keep to the left as the path forks and meanders." },
        { "type": "dialogue", "character": "Moo", "text": "The key to detection is to be observant of everything! The flight pattern of birds, the shape of the clouds..." },
        { "type": "dialogue", "character": "Hazel", "text": "The thief knows we'll be looking ahead. They might have left a clue where we'd least expect it. Keep your eyes peeled, and check your feet as well as the horizon." }
    ],
    "directionsImages": ["straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "As you walk, Hazel suddenly stops. 'There,' she says, pointing her paw at a small, round, green utility cover set into the dirt of the path." },
        { "type": "dialogue", "character": "Moo", "text": "A drain cover? How dreadfully boring. What clue could possibly be found on something so... functional?" },
        { "type": "dialogue", "character": "Hazel", "text": "The most important clues are often hidden in the most mundane places. The thief is counting on us to think it's boring and walk right past." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Look closely at the green cover on the ground. There is a four-letter word stamped into the metal. It is a brand name, but also a word from another language.\n\nWhat is this four-letter word? Finding it is the key to identifying our next suspect."
    },
    "type": "suspect",
    "answer": "Senor Toro",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Player", "text": "Toro!" },
        { "type": "dialogue", "character": "Moo", "text": "Toro! I know that word! It means 'bull' in Spanish! It must be Señor Toro!" },
        { "type": "dialogue", "character": "Hazel", "text": "Exactly. It’s his name, which is why it can’t be him. Señor Toro is loud and proud. He’d never hide a clue this subtle. He’d want the whole world to see it. This is far too humble for him." },
        { "type": "story", "text": "You agree — a drain cover is far too quiet for Señor Toro’s dramatic style. You strike him off the suspect list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. The word stamped here is TORO — Spanish for bull. It points us to Señor Toro. But think about it: he’d never settle for a drain cover. He’d want fireworks and fountains. Cross him off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "Who knew a humble drain could be so revealing? Great spotting!"
    }
},

{
    "title": "The Conundrum",
    "subtitle": "Clue #16",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the plant sign behind, continuing along the path from the top of the tree-lined avenue. Following Hazel's expert guidance, you always keep to the left as the path forks and meanders." },
        { "type": "dialogue", "character": "Moo", "text": "The key to detection is to be observant of everything! The flight pattern of birds, the shape of the clouds..." },
        { "type": "dialogue", "character": "Hazel", "text": "The thief knows we'll be looking ahead. They might have left a clue where we'd least expect it. Keep your eyes peeled, and check your feet as well as the horizon." }
    ],
    "directionsImages": ["left-turn.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "You leave the shaded path and enter a wide, grassy clearing. And there, rising above you against the blue sky, is a magnificent, ruined stone tower." },
        { "type": "dialogue", "character": "Moo", "text": "Wow! A real-life castle! My very own fortress of 'Moo-ditude'! The thief wouldn't dare approach now that the king has arrived!" },
        { "type": "dialogue", "character": "Hazel", "text": "It's a folly, not a fortress. But your royal game has given me an idea. The shape of that building is the entire clue." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Look carefully at the main stone building in front of you.\n\nIn the famous board game of chess, one of the most powerful pieces is designed to look just like that structure.\n\nWhat is the five-letter name of that chess piece?\n\nHint: The animal represented by this chess piece's name would love to eat one of the objects on your list."
    },
    "type": "object",
    "answer": "A Bag of Birdseed",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "A Rook! And a rook — the bird — would eat birdseed! The thief was planning to bribe an army of crows to act as lookouts. A feathered spy network!" },
        { "type": "dialogue", "character": "Hazel", "text": "Clever theory, but it doesn’t fit the facts. The apple was stolen indoors. Birdseed wouldn’t help there. It’s messy, wild, and totally wrong for a clean, precise theft." },
        { "type": "story", "text": "You agree. A Bag of Birdseed doesn’t fit the crime scene at all. You strike it from the list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. It’s ROOK — the chess piece shaped like a tower. And rooks — the birds — love birdseed. But birdseed wouldn’t help steal a magical apple indoors. Too messy. Cross it off!" }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "A brilliant deduction! One less bird-bribe to worry about!"
    }
},

{
    "title": "The D-Stair",
    "subtitle": "Clue #17",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the grassy clearing and bravely enter the base of the stone tower. A metal spiral staircase winds its way up into the sky." },
        { "type": "dialogue", "character": "Moo", "text": "Upwards, my friends! Into the heart of the mystery! Watch out for tripwires and... and very narrow stairs!" },
        { "type": "story", "text": "You carefully follow Hazel as she pads up the winding metal steps, her claws making soft click-clack sounds on the treads. As you near the top, a remarkable metal sculpture comes into view." }
    ],
    "directionsImages": ["straight-arrow.png", "left-turn.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "As your head rises above the level of the top floor, you come face-to-face with a creature of legend wrapped around the handrail." },
        { "type": "dialogue", "character": "Moo", "text": "A beastie! Stand back, team, I'll handle this!" },
        { "type": "dialogue", "character": "Hazel", "text": "It's made of metal, Moo. It's a beautiful piece of art. But it's also a fantastic clue. One of our suspects is known for having a legendary ego, and identifying this mythical creature will help us rule them out." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Examine the metal mythical beast clinging to the central post. What is the six-letter name of this creature?\n\nHint: The name of this creature, in an ancient language, is also the name of one of our suspects. This will help you identify them."
    },
    "type": "suspect",
    "answer": "Professor Draco",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "A Dragon! And that must mean Professor Draco — his name even means 'dragon' in an ancient language!" },
        { "type": "dialogue", "character": "Hazel", "text": "On the contrary. Professor Draco is vain. He believes he is unique. He would never choose a lair that already has a statue of another dragon. He’d find it dreadfully tacky." },
        { "type": "story", "text": "You agree — he’d never allow another dragon to share his spotlight. You cross Professor Draco off the suspect list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. It’s a DRAGON — six letters, mythical, and it matches our suspect, Professor Draco. But someone as vain as him wouldn’t pick a place that already has a dragon statue. Too tacky. Cross him off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "You faced the beast and won — Professor Draco doesn’t stand a chance!"
    }
},

{
    "title": "A Coded Caution",
    "subtitle": "Clue #18",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You carefully make your way back down the winding metal staircase, your footsteps echoing around you. At the bottom, you step back out into the grassy clearing at the foot of the magnificent tower." },
        { "type": "dialogue", "character": "Moo", "text": "Phew! Solid ground! My head is still spinning. Now, where were we?" },
        { "type": "story", "text": "Hazel is already patiently waiting by a low wooden sign near the base of the tower wall." },
        { "type": "dialogue", "character": "Hazel", "text": "The clue is here, Moo." }
    ],
    "directionsImages": ["wait.png"],
    "clueStory": [
        { "type": "dialogue", "character": "Hazel", "text": "Ignore the big words at the top. The real clue is hidden where only a true detective would look – in the official safety warnings. The thief has used the phrase on one of them as a secret code." },
        { "type": "dialogue", "character": "Moo", "text": "A code? Hidden in a warning? How fiendishly clever! It will take a master detective like myself to crack it." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Look at the text on one of the small yellow warning signs.\n\nFirst, read the three-word warning phrase. Then, to find the five-letter object to eliminate, extract letters from these specific positions (ignore the spaces between words):\n\n1. Take the 15th letter.\n2. Then the 1st letter.\n3. Then the 18th letter.\n4. Then the 16th letter.\n5. Finally, the 17th letter.\n\nPut the five letters together to spell the object's name."
    },
    "type": "object",
    "answer": "A Woolly Scarf",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "A Scarf! To protect the thief from the cold! Or as a disguise! Very clever!" },
        { "type": "dialogue", "character": "Hazel", "text": "It would be — if it weren’t a warm, sunny day. Anyone wearing a woolly scarf would look odd and be remembered. Our thief is smarter than that." },
        { "type": "story", "text": "You agree. It’s far too conspicuous. You confidently strike A Woolly Scarf from your list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Check again — the phrase 'Caution Uneven Surface'. The 15th, 1st, 18th, 16th, and 17th letters spell S-C-A-R-F. But a heavy woolly scarf? On a warm day? Way too obvious. Cross it off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "You cracked the code and unraveled another suspect — nicely done!"
    }
},

{
    "title": "The Solar Secret",
    "subtitle": "Clue #19",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the castle tower behind, heading back the way you came, but this time you continue straight, following the path as it slopes downhill. The trees thin out, and you keep your eyes peeled to the right as instructed." },
        { "type": "dialogue", "character": "Moo", "text": "Downhill is a welcome change. Much more dignified than all that climbing." },
        { "type": "story", "text": "Suddenly, Hazel stops and looks to her right. 'There,' she says, her gaze fixed on a tall, pointed stone monument topped with a golden sphere, standing proudly in a clearing." }
    ],
    "directionsImages": ["straight-arrow.png", "right-turn.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "The three of you approach the towering obelisk. Moo's eyes are fixed on the golden ball at the very top, glinting in the sun." },
        { "type": "dialogue", "character": "Moo", "text": "I've found it! The Golden Apple! It's right there! The thief put it on top of that pointy thing! Case closed!" },
        { "type": "dialogue", "character": "Hazel", "text": "That's just a golden ball, Moo. And the real clue is, as usual, in the words." },
        { "type": "story", "text": "She gestures to the stone plaque set into the monument’s base. 'Interestingly, this is dedicated to the same lady as the blue plaque we saw earlier. She was clearly very important.'" }
    ],
    "task": {
        "character": "Hazel",
        "text": "The writing on this stone plaque is very old and worn by the weather. Look very carefully at the last line of carved text. It tells of a wonderful idea brought to England from another nation.\n\nWhat is the six-letter name of that country?"
    },
    "type": "suspect",
    "answer": "Thomas Turkey",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "Turkey! That points the finger directly at Thomas Turkey! He must have been trying to steal the Golden Apple and smuggle it back to his homeland!" },
        { "type": "dialogue", "character": "Hazel", "text": "Interesting theory, but this monument honours someone who brought a life-saving idea from Turkey to England — a symbol of sharing and friendship. Thomas Turkey is famously proud and patriotic. He wouldn’t get involved in a crime tied to a place that honours another country so highly." },
        { "type": "story", "text": "You agree — his ego wouldn’t allow it. You confidently cross Thomas Turkey off the list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look again — the last line clearly says T-U-R-K-E-Y. But Thomas Turkey? He’s far too patriotic to steal from a monument celebrating friendship with another nation. Cross him off!" }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "You read the signs — and the stone! Brilliant detective work!"
    }
},



{
    "title": "The Alibi",
    "subtitle": "Clue #20",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the tall Sun Monument and continue heading downhill, the path winding gently through the trees." },
        { "type": "dialogue", "character": "Moo", "text": "Always be vigilant! A clue could be anywhere!" },
        { "type": "story", "text": "He says this while attempting to balance a twig on his nose." },
        { "type": "dialogue", "character": "Hazel", "text": "It helps if you're actually looking at the path. The trail notes say the next clue is hidden off the main path. Look for a gateway made of old stone." },
        { "type": "story", "text": "Following her direction, you spot the impressive triple-arched gate through a gap in the woods." }
    ],
    "directionsImages": ["straight-arrow.png", "right-turn.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "You arrive at the beautiful stone gate. Near it, a small wooden sign gives the location its name." },
        { "type": "dialogue", "character": "Moo", "text": "A gate like this, leading into a forest? This must be where a famous outlaw practiced! Someone who was an expert with a bow and arrow! He would have stood right here and... and shot an apple off my head!" },
        { "type": "dialogue", "character": "Hazel", "text": "I don't think so, Moo. But the name of this gate is definitely the clue. Our thief has used the sign to point us to another useless tool." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Look at the small wooden sign that names the gateway.\n\nWhat is the first, six-letter word written on the sign? It will identify an object on your list that is completely impractical for this particular crime."
    },
    "type": "object",
    "answer": "Bow and Arrow",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "An Archer! That means the thief used a bow and arrow! They must be a skilled marksman!" },
        { "type": "dialogue", "character": "Hazel", "text": "That sounds exciting, but it only happens in storybooks. The Golden Apple was inside a building. Firing an arrow to perfectly snag one small object? Nearly impossible. Our thief wouldn’t take that chance." },
        { "type": "story", "text": "You agree — it’s far too unreliable. You cross A Bow and Arrow off your list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look at the sign — the word is ARCHER. That means the object is a bow and arrow. But no thief would risk a trick shot in a museum. Too flashy. Too unreliable. Cross it off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "A perfect shot, detective! That bow's out of the game!"
    }
},


{
    "title": "The Rest",
    "subtitle": "Clue #21",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You continue your journey from the stone gateway, always heading downhill. The path is dappled with sunlight filtering through the trees. After a short walk, you come to a clearing on your right that opens up to a magnificent panorama of the countryside below." },
        { "type": "dialogue", "character": "Moo", "text": "My word, what a spectacular outlook! A perfect spot for a detective to take a moment, ponder the facts, and perhaps enjoy a small, well-deserved biscuit." },
        { "type": "story", "text": "Hazel isn't admiring the scenery. Her sharp eyes are fixed on a small wooden sign that names the spot." },
        { "type": "dialogue", "character": "Hazel", "text": "I think you'll have to stand, Moo. There's something very odd here." }
    ],
    "directionsImages": ["right-turn.png", "straight-arrow.png", "right-turn.png"],
    "clueStory": [
        { "type": "story", "text": "You join Hazel at the sign. Moo trots over, ready for a rest. He reads the sign, then looks around the clearing in confusion." },
        { "type": "dialogue", "character": "Moo", "text": "But... it says this is a place to sit down. I don't see anywhere to sit at all! My hooves are getting tired just thinking about it." },
        { "type": "dialogue", "character": "Hazel", "text": "Exactly. Something important is missing. And that absence is our clue. It proves that one of the objects on our list is not part of this crime." }
    ],
    "task": {
        "character": "Hazel",
        "text": "Read the sign that names this place. It's made of two words.\n\nWhat is the four-letter second word on the sign? It names the very thing that is conspicuously absent from this spot, and it will help you eliminate a much larger, similar object from your list."
    },
    "type": "object",
    "answer": "A Wooden Bench",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "The seat! The thief has stolen an entire bench! They must be incredibly strong!" },
        { "type": "dialogue", "character": "Hazel", "text": "They might be strong, but they’re also stealthy. Our thief stole a priceless apple without a trace. They wouldn’t draw attention by dragging a big, clunky bench through the gardens." },
        { "type": "story", "text": "You agree — it’s far too large and noisy for a secret mission. You strike A Wooden Bench off the list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look closer — the second word is SEAT. But there’s no seat anywhere! That’s the clue. A thief wouldn’t risk dragging a wooden bench through here. Too obvious. Cross it off." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "You uncovered the invisible clue — and gave my hooves hope!"
    }
},


{
    "title": "The Calculated Cover",
    "subtitle": "Clue #22",
    "cypherImage": "",
    "directions": [
        { "type": "story", "text": "You leave the viewpoint of the missing seat, cross over the main path, and follow a smaller trail that leads into a lush, green garden area." },
        { "type": "dialogue", "character": "Moo", "text": "Excellent work, team! The thief is clearly trying to confuse us with all these different paths, but they are no match for my... uh... path-following skills!" },
        { "type": "story", "text": "Tucked away amongst ferns and bushes, you all spot the next location: a sturdy-looking stone shelter with a distinctive red-painted wooden front." }
    ],
    "directionsImages": ["straight-arrow.png", "stop.png"],
    "clueStory": [
        { "type": "story", "text": "You stand before the quiet, empty shelter." },
        { "type": "dialogue", "character": "Moo", "text": "A perfect ambush spot! The thief could be hiding in there right now, ready to pounce! Stay alert!" },
        { "type": "dialogue", "character": "Hazel", "text": "It's not an ambush spot, Moo. It's a clue. And like the building itself, the answer is very simple and right in front of our eyes. The entire structure is a two-part code." }
    ],
    "task": {
        "character": "Hazel",
        "text": "This shelter will give you two numbers. Together, they form the initials of our next suspect. You'll need to use the code A=1, B=2, C=3 and so on.\n\nFor the FIRST initial: Count the number of main, red wooden posts at the front.\n\nFor the SECOND initial: Count the number of horizontal layers of stone on the back wall, from the ground up to the wooden roof beam.\n\nConvert your two numbers into letters to get the initials, then check your suspect list."
    },
    "type": "suspect",
    "answer": "Bertram Hedgehog",
    "correctAnswerReason": [
        { "type": "dialogue", "character": "Moo", "text": "B.H.! Bertram Hedgehog! He could have curled into a ball and rolled right past the guards! A spiky cannonball of crime!" },
        { "type": "dialogue", "character": "Hazel", "text": "He is spiky, but he is also famously nocturnal. Bertram does all his important business at night. The Golden Apple was stolen in broad daylight, during the busy Fête preparations, when the sun was high in the sky. Bertram would have been fast asleep in a cosy pile of leaves somewhere." },
        { "type": "story", "text": "You agree; a creature of the night wouldn’t be committing crimes in the afternoon. You cross Bertram Hedgehog off your list." }
    ],
    "wrongAnswerReason": [
        { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look closer — two posts and eight stone layers. That gives us B. H. — Bertram Hedgehog." },
        { "type": "dialogue", "character": "Hazel", "text": "But Bertram’s a night creature. This heist happened in broad daylight — he’d have been fast asleep! Definitely not our thief." }
    ],
    "motivationalQuote": {
        "character": "Moo",
        "text": "A spiky cannonball of crime? Now *that’s* a suspect profile!"
    }
},


{
  "title": "A Moment's Notice",
  "subtitle": "Clue #23",
  "cypherImage": "",
  "directions": [
    { "type": "story", "text": "You leave the quiet shelter, heading back the way you came and continuing your journey downhill. The path leads you into the entrance of another, different style of garden." },
    { "type": "dialogue", "character": "Moo", "text": "Onwards! The scent of the trail is strong here! It smells of... flowers! And... is that mint? A clue, I'm sure of it!" },
    { "type": "dialogue", "character": "Hazel", "text": "That's just the garden, Moo. The trail notes say we should go to the very centre of this garden, and then look around for a sign that talks about experiences." },
    { "type": "story", "text": "You follow her to the middle of the garden and begin your search." }
  ],
  "directionsImages": ["u-turn.png", "turn-left.png", "straight-arrow.png", "turn-left.png", "stop.png"],
  "clueStory": [
    { "type": "story", "text": "You spot the distinctive three-sided sign. It describes how the garden is designed to appeal to all the senses." },
    { "type": "dialogue", "character": "Moo", "text": "I'm getting a note of... intrigue! With a hint of... mystery! And a base note of... compost!" },
    { "type": "dialogue", "character": "Hazel", "text": "It says here that many of the plants have a use. And one of those uses gives us a clue about an object our practical thief would have left behind." }
  ],
  "task": {
    "character": "Hazel",
    "text": "This sign describes a specific, well-known herb and even includes a drawing of it.\n\nFirst, find the section about that pictured herb. In the text there, you will find the three-letter name of a common, hot beverage that can be made from its leaves. What is that drink?"
  },
  "type": "object",
  "answer": "A Flask of Tea",
  "correctAnswerReason": [
    { "type": "dialogue", "character": "Moo", "text": "Tea! My favourite! The thief must have brought a flask of hot tea with them to keep their nerves steady during the heist!" },
    { "type": "dialogue", "character": "Hazel", "text": "A flask is a bulky, heavy object. Our thief is travelling light, moving quickly and quietly through the gardens. They wouldn't weigh themselves down with a clanking flask full of liquid, especially on a fine day like today." },
    { "type": "story", "text": "You agree; it's too much to carry. You cross A Flask of Tea off your list of objects." }
  ],
  "wrongAnswerReason": [
    { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look here — it even shows a picture of rosemary, and right in the text it says you can make tea. That’s the answer." },
    { "type": "dialogue", "character": "Hazel", "text": "But a flask of tea? Too heavy, too noisy, and hardly subtle for a quick getaway. Not the thief’s style at all!" }
  ],
  "motivationalQuote": {
    "character": "Moo",
    "text": "A base note of compost? Truly, I’m a scent-sational detective!"
  }
},

{
  "title": "A Motto for a Mystery",
  "subtitle": "Clue #24",
  "cypherImage": "",
  "directions": [
    { "type": "story", "text": "From the sign about senses, you return to the middle of the garden to get your bearings." },
    { "type": "dialogue", "character": "Moo", "text": "I'm telling you, it smells like gingerbread. Definitely a gingerbread clue!" },
    { "type": "dialogue", "character": "Hazel", "text": "It's not gingerbread, Moo. It's the smell of roses. And our next clue is right beside them." },
    { "type": "story", "text": "You follow her to another three-sided sign, this one with a bold, three-word motto written down its side." }
  ],
  "directionsImages": ["wait.png"],
  "clueStory": [
    { "type": "story", "text": "You stand before the new sign. Moo looks at the motto on the side panel." },
    { "type": "dialogue", "character": "Moo", "text": "What a splendid motto! Very fitting for a detective's life, don't you think? We learn new things, we find clues in the world, and we live to solve another crime!" },
    { "type": "dialogue", "character": "Hazel", "text": "One of those words is more important than the others right now. In fact, it's part of a suspect's full name. The thief is getting very bold." }
  ],
  "task": {
    "character": "Hazel",
    "text": "Look at the three-word motto.\n\nWhat is the second, five-letter word in that motto?\n\nThe word you find is part of the full name of the next suspect you can cross off your list."
  },
  "type": "suspect",
  "answer": "Heckles the Laughing Hyena",
  "correctAnswerReason": [
    { "type": "dialogue", "character": "Moo", "text": "Laugh! And the only suspect with that in their name is Heckles the Laughing Hyena! He's mocking us! The nerve of that cackling crook!" },
    { "type": "dialogue", "character": "Hazel", "text": "But read this. It says this garden was created to be a place of 'friendship and happiness', to be 'bright and cheerful'. Heckles' famous laugh isn't cheerful, is it? It's mischievous and unsettling. A place of genuine, quiet happiness like this would be incredibly boring to a chaos-lover like him." },
    { "type": "story", "text": "You nod in agreement and cross Heckles the Laughing Hyena off your list." }
  ],
  "wrongAnswerReason": [
    { "type": "dialogue", "character": "Hazel", "text": "Not quite. The word we needed was Laugh. That points us to Heckles the Laughing Hyena." },
    { "type": "dialogue", "character": "Hazel", "text": "But think — this garden is all about ‘friendship and happiness,’ quiet and cheerful. Heckles thrives on chaos and mischief, not calm joy. Totally wrong vibe for him." }
  ],
  "motivationalQuote": {
    "character": "Moo",
    "text": "Learn! Laugh! Live! And always carry snacks."
  }
},


{
  "title": "A Patriotic Puzzle",
  "subtitle": "Clue #25",
  "cypherImage": "",
  "directions": [
    { "type": "story", "text": "From the sign with the three-word motto, you once again return to the centre of the garden to get your bearings." },
    { "type": "dialogue", "character": "Moo", "text": "Goodness me, this garden is full of clues! The thief must be very confident, or very careless! Let's see what this one says." },
    { "type": "story", "text": "You join Hazel by the sign, which is titled 'Welcome to the Wilderness'." }
  ],
  "directionsImages": ["wait.png"],
  "clueStory": [
    { "type": "dialogue", "character": "Moo", "text": "Wilderness? This seems rather well-kept for a wilderness. I was expecting more... jungle. And fewer neatly trimmed hedges." },
    { "type": "dialogue", "character": "Hazel", "text": "It's about the history of the garden, Moo. It says here that part of the garden was designed to look like a famous national symbol when seen from above. A very patriotic puzzle for a very un-patriotic thief." }
  ],
  "task": {
    "character": "Hazel",
    "text": "Read the text carefully. It explains that one part of the garden is named after a very famous emblem because the layout of the paths looks like it.\n\nWhat is the four-letter name of this famous patterned symbol?"
  },
  "type": "object",
  "answer": "A Signal Flag",
  "correctAnswerReason": [
    { "type": "dialogue", "character": "Moo", "text": "Flag! As in, a signal flag! The thief must have an accomplice on a distant hill, sending them secret messages by waving different coloured flags!" },
    { "type": "dialogue", "character": "Hazel", "text": "A brilliant idea for a secret agent, Moo, but not for a stealthy thief. The entire purpose of a signal flag is to be seen from a great distance. It's designed to attract attention. Our thief is trying to do the exact opposite – to go completely unnoticed." },
    { "type": "story", "text": "You agree; it's far too conspicuous. You cross A Signal Flag off your list." }
  ],
  "wrongAnswerReason": [
    { "type": "dialogue", "character": "Hazel", "text": "Not quite. It’s FLAG. The garden was designed to look like the Union Flag from above — see?" },
    { "type": "dialogue", "character": "Hazel", "text": "A signal flag would only draw attention. Not exactly what a sneaky thief would want! Too flashy, too obvious. So we can cross it off." }
  ],
  "motivationalQuote": {
    "character": "Moo",
    "text": "When in doubt, wave a flag... but not if you're a criminal!"
  }
},


{
  "title": "The Picnic Plot",
  "subtitle": "Clue #26",
  "cypherImage": "",
  "directions": [
    { "type": "story", "text": "From the sign about the garden's history, you return once more to the centre of the garden." },
    { "type": "dialogue", "character": "Moo", "text": "All this detective work is terribly draining on the stomach. I do hope the next clue is somewhere... snack-adjacent." },
    { "type": "dialogue", "character": "Hazel", "text": "Well, Moo, it looks like you're in luck." }
  ],
  "directionsImages": ["wait.png"],
  "clueStory": [
    { "type": "story", "text": "You arrive at a sign that designates the area as a place for picnics." },
    { "type": "dialogue", "character": "Moo", "text": "A picnic spot! Splendid! They mention cold ham and chicken! This is the best clue yet!" },
    { "type": "dialogue", "character": "Hazel", "text": "Focus, Moo. The food isn't the clue. The clue is the person who wrote about the food. Our thief has a literary streak. They've used a famous author's name to point us to one of their accomplices." }
  ],
  "task": {
    "character": "Hazel",
    "text": "The sign tells us who wrote this famous book.\n\nWhat is the four-letter first name of the author mentioned on the sign? It's the same first name as the next suspect you can cross off your list."
  },
  "type": "suspect",
  "answer": "Jane Doe",
  "correctAnswerReason": [
    { "type": "dialogue", "character": "Moo", "text": "Jane! As in Jane Doe! She's as clever and witty as the author! She must be the mastermind!" },
    { "type": "dialogue", "character": "Hazel", "text": "She is certainly clever, but read the quote again. It's about 'forming parties' and eating with friends and family. Jane Doe is famously shy and reclusive. She prefers the quiet of the deep woods to a noisy, crowded party. A big social event like a picnic is the very last place you would find her." },
    { "type": "story", "text": "You have to agree — the social setting doesn't fit the shy suspect's personality. You cross Jane Doe off the list." }
  ],
  "wrongAnswerReason": [
    { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look closer — it’s JANE. The author of the book mentioned here, Sense & Sensibility. That points us straight to Jane Doe on our list." },
    { "type": "dialogue", "character": "Hazel", "text": "But think about it — this quote is all about parties and picnics. Jane Doe hates crowds! She’d never come near a noisy gathering like this. That’s why we can cross her off." }
  ],
  "motivationalQuote": {
    "character": "Moo",
    "text": "Picnic spots are excellent for clues... and sandwiches!"
  }
},

{
  "title": "The Wooden Animal",
  "subtitle": "Clue #27",
  "cypherImage": "",
  "directions": [
    { "type": "story", "text": "You leave the sensory garden through the bottom exit, finding yourself on a path that runs alongside a thin belt of grassy woodland." },
    { "type": "dialogue", "character": "Moo", "text": "The final act! The chase is on! I have a feeling the thief is hiding somewhere amongst these very trees!" },
    { "type": "dialogue", "character": "Hazel", "text": "Let's not get ahead of ourselves. The thief is smart. They might have left a decoy for us." }
  ],
  "directionsImages": ["straight.png", "left.png", "stop.png"],
  "clueStory": [
    { "type": "story", "text": "The three of you approach the small, painted wooden animal." },
    { "type": "dialogue", "character": "Moo", "text": "Aha! A suspect! Frozen in fear at the sight of us! He's cornered! Quick, someone get the tiny handcuffs!" },
    { "type": "dialogue", "character": "Hazel", "text": "Moo, it's made of wood." },
    { "type": "story", "text": "As she does, her fuzzy red-merle ear briefly enters your view — looking remarkably like the one in the photograph from this very clue. She doesn’t notice and focuses back on the wooden animal." },
    { "type": "dialogue", "character": "Hazel", "text": "The real question is, what kind of animal is it supposed to be? Identifying it is the key." }
  ],
  "task": {
    "character": "Hazel",
    "text": "This animal is famous in stories for being sneaky and sly.\n\nWhat is the six-letter name of this type of wild animal?\n\nThe answer will identify our next suspect."
  },
  "type": "suspect",
  "answer": "Willy Weasel",
  "correctAnswerReason": [
    { "type": "dialogue", "character": "Moo", "text": "A weasel! It must be Willy Weasel! He's left a wooden version of himself to lead us astray! A classic double-bluff!" },
    { "type": "dialogue", "character": "Hazel", "text": "But is it? Willy Weasel prides himself on stealth and his ability to go completely unnoticed. Would a creature like that really leave a cartoonish cutout of himself in plain sight? It's too obvious." },
    { "type": "story", "text": "You agree — this clue is far too clumsy for someone like Willy Weasel. You cross him off your suspect list." }
  ],
  "wrongAnswerReason": [
    { "type": "dialogue", "character": "Hazel", "text": "Not quite. Look closer — it’s a weasel. Long, sly, and sneaky — just like in the stories. That means it's pointing to Willy Weasel." },
    { "type": "dialogue", "character": "Hazel", "text": "But honestly? Willy would never leave something this obvious. He’s a master of disguise, not a show-off. That’s why we can cross him off." }
  ],
  "motivationalQuote": {
    "character": "Moo",
    "text": "Wooden cutouts make terrible suspects — they crack under pressure!"
  }
},

{
  "title": "The Final Signs",
  "subtitle": "Clue #28",
  "cypherImage": "",
  "directions": [
    { "type": "story", "text": "You leave the wooden animal behind and back along the path, retracing your steps towards the temple where you solved the chess puzzle earlier." },
    { "type": "dialogue", "character": "Moo", "text": "Backwards? But we just came down! My hooves are going in circles! I think this is all just a wild goose chase!" },
    { "type": "dialogue", "character": "Hazel", "text": "Perhaps. The thief wants us to be tired and confused for the final confrontation. But we are one step ahead of them." }
  ],
  "directionsImages": ["uturn.png", "left.png", "stop.png"],
  "clueStory": [
    { "type": "story", "text": "Hazel looks at the signpost as a whole." },
    { "type": "dialogue", "character": "Hazel", "text": "Ignore the words, ignore the symbols, and just look at the structure." },
    { "type": "dialogue", "character": "Hazel", "text": "How many separate sign arms are pointing to the left?" },
    { "type": "dialogue", "character": "Hazel", "text": "Hint: The number you find is the same as the number of letters in the first name of our final innocent suspect." }
  ],
  "task": {
    "character": "Hazel",
    "text": "How many arms point left? The number reveals the first name length of the last innocent suspect."
  },
  "type": "suspect",
  "answer": "Al Badger",
  "correctAnswerReason": [
    { "type": "story", "text": "You count the signs pointing left and get the number two. Following the hint, you find the only suspect with a two-letter first name." },
    { "type": "dialogue", "character": "You", "text": "Al Badger!" },
    { "type": "dialogue", "character": "Hazel", "text": "Exactly. Al is a simple creature who loves his quiet life underground. He would have no interest in a flashy golden apple and no skill in creating such a complex trail. He is innocent." },
    { "type": "story", "text": "She looks at you, eyes gleaming with triumph." },
    { "type": "dialogue", "character": "Hazel", "text": "And with Al cleared, that leaves only one name left on our suspect list..." },
    { "type": "story", "text": "You look at your list. The name stands out, clear as day. Felicity Fox is the thief!" },
    { "type": "dialogue", "character": "Moo", "text": "Of course! She was sly enough to create this entire trail of clues to lead us in circles!" },
    { "type": "dialogue", "character": "Hazel", "text": "And look. There is only one object remaining. She must have used [The Final Object] to pull off the heist!" },
    { "type": "dialogue", "character": "Moo", "text": "But where has she hidden the apple?" },
    { "type": "dialogue", "character": "Hazel", "text": "The thief didn’t just leave a clue; they left us directions. Gardens, Castle, Café… and 'Way out'. She's making a run for it!" },
    { "type": "story", "text": "The three of you lock eyes, a shared sense of purpose passing between you. The case is solved, but the chase is on!" },
    { "type": "dialogue", "character": "You", "text": "Come on, team! Let's get that apple back!" },
    { "type": "story", "text": "Congratulations, Detective! You've solved the mystery of the Golden Apple of Wentworth!" }
  ],
  "wrongAnswerReason": [
    { "type": "dialogue", "character": "Hazel", "text": "Good effort, but look closer. There are two sign arms pointing left — that’s the key. The only suspect with a two-letter first name is Al Badger." },
    { "type": "dialogue", "character": "Hazel", "text": "Al loves nothing more than a quiet burrow and a nap. This whole elaborate trail? Not his style at all. He’s innocent." },
    { "type": "dialogue", "character": "Hazel", "text": "And with Al cleared, that leaves just one name on your list…" },
    { "type": "story", "text": "Your eyes drop to the paper. Of course — Felicity Fox!" },
    { "type": "dialogue", "character": "Hazel", "text": "She’s clever enough to set this whole thing up. And see? The signpost even points the way she ran — Gardens, Castle, Café… and Way Out. She’s making her escape!" },
    { "type": "story", "text": "You feel a rush of excitement. The thief unmasked, the final object uncovered, and the apple almost in sight." },
    { "type": "dialogue", "character": "You", "text": "Let’s move, team!" },
    { "type": "story", "text": "Congratulations, Detective — you solved the mystery of the Golden Apple of Wentworth!" }
  ],
  "motivationalQuote": {
    "character": "Hazel",
    "text": "Even the final clue was hiding in plain sight. You're more than ready for your next mystery!"
  }
},





                ],
                awardTiers: [
                    { score: 280, img: '100.png', title: '🦸 Mastermind of Mysteries', dialogue: [
                        { character: 'Moo', text: "“<player's name>! You’ve cracked every clue! I always knew you were secretly… a genius in disguise. Possibly disguised as a genius.”" },
                        { character: 'Hazel', text: "“Disguised or not, <player's name> just solved everything. Meanwhile, you’re still trying to interrogate a tree.”" }
                    ]},
                    { score: 250, img: '90.png', title: '🕵️ Super Sleuth', dialogue: [
                        { character: 'Moo', text: "“<player's name>! You were magnificent — just shy of perfection! If only you’d listened to my brilliant theories about the hedges.”" },
                        { character: 'Hazel', text: "“If <player's name> had listened to you, we’d still be questioning the birdbath. Good work, <player's name>.”" }
                    ]},
                    { score: 200, img: '75.png', title: '🔍 Clever Clue-Hound', dialogue: [
                        { character: 'Moo', text: "“<player's name>, you sniffed out most of the trail! You’re practically honorary cow-detective now.”" },
                        { character: 'Hazel', text: "“They did well, Moo. But let’s not pretend a cow has ever successfully solved anything.”" }
                    ]},
                    { score: 150, img: '50.png', title: '🐾 Bumbling Bloodhound', dialogue: [
                        { character: 'Moo', text: "“Ah, <player's name> — you stumbled, you fumbled, but you made it here in the end! That’s the spirit of a true… confused champion.”" },
                        { character: 'Hazel', text: "“You mean ‘determined’. Though ‘confused’ fits too. Well done anyway, <player's name>.”" }
                    ]},
                    { score: 50, img: '25.png', title: '🤔 Confused Constable', dialogue: [
                        { character: 'Moo', text: "“Well… <player's name>… you did catch some clues. Which is more than I can say for Hazel when she tried to catch her own tail.”" },
                        { character: 'Hazel', text: "“Unlike you, <player's name> actually helped — even if they did accuse a flowerpot at one point.”" }
                    ]},
                    { score: 1, img: '01.png', title: '😵 Lost in the Labyrinth', dialogue: [
                        { character: 'Moo', text: "“Oh dear. <player's name>, you appear to have been… heroically lost the entire time. Admirable commitment to wandering aimlessly!”" },
                        { character: 'Hazel', text: "“At least <player's name> didn’t try to arrest the sun like you did, Moo. Progress.”" }
                    ]},
                    { score: 0, img: '00.png', title: '🐌 Detective Sloth', dialogue: [
                        { character: 'Moo', text: "“Ah, <player's name>. Clearly saving your energy for… the next case. A bold tactic.”" },
                        { character: 'Hazel', text: "“Or maybe just asleep the whole time, like you during stakeouts, Moo. Better luck next time, <player's name>.”" }
                    ]}
                ]
            };

            // --- CORE FUNCTIONS ---

            function renderNarrative(contentContainer, narrativeData) {
                contentContainer.innerHTML = ''; // Clear previous content
                narrativeData.forEach(item => {
                    const dialogueClass = item.character === 'Hazel' ? 'dialogue-hazel' :
                                      item.character === 'Moo' ? 'dialogue-moo' : 'dialogue-other';

                    if (item.type === 'story') {
                        const storyContainer = document.createElement('div');
                        storyContainer.className = 'story-paragraph-container';
                        storyContainer.innerHTML = `
                            <div class="icon"><img src="book.png" alt="Story icon" onerror="this.style.display='none'"/></div>
                            <p>${item.text}</p>
                        `;
                        contentContainer.appendChild(storyContainer);
                    } else if (item.type === 'dialogue') {
                        const speakerData = gameData.characters.find(s => s.name === item.character);
                        const speaker = speakerData || { name: 'Narrator', img: 'book.png' };
                        const dialogueContainer = document.createElement('div');
                        dialogueContainer.className = `dialogue-container ${dialogueClass}`;
                        dialogueContainer.innerHTML = `
                            <img src="${speaker.img}" alt="${speaker.name}" class="character-avatar" onerror="this.style.display='none'">
                            <p>${item.text.replace('<span id="player-name-placeholder">Detective</span>', `<span id="player-name-placeholder">${gameState.detectiveName}</span>`)}</p>
                        `;
                        contentContainer.appendChild(dialogueContainer);
                    }
                });
            }

            function navigateTo(screenName) {
                gameState.currentScreen = screenName;
                renderUI();

                const clue = gameData.clues[gameState.currentClueIndex];

                if (screenName === 'story') {
                    renderNarrative(elements.dynamicContent.storyScreenContent, gameData.storyScreens.story);
                } else if (screenName === 'introStory') {
                    renderNarrative(elements.dynamicContent.introStoryContent, gameData.storyScreens.introStory);
                }

                if (!clue && screenName !== 'grandReveal' && screenName !== 'detectiveAward' && screenName !== 'certificate') {
                    if(screenName === 'progress') updateProgressScreen();
                    return;
                }

                // Update progress indicators
                if (clue) {
                    const progressText = `Clue ${clue.subtitle.replace('#', '')} of ${gameData.clues.length}`;
                    Object.values(elements.dynamicContent.progressIndicators).forEach(indicator => {
                        indicator.textContent = progressText;
                    });
                }


                if (screenName === 'cluePopup') {
                    elements.dynamicContent.cluePopupTitle.textContent = `🔎 ${clue.subtitle} - ${clue.title}`;
                    setTimeout(() => navigateTo('directions'), 2500);
                } else if (screenName === 'directions') {
                    elements.dynamicContent.directionsSubtitle.textContent = clue.title;
                    renderNarrative(elements.dynamicContent.directionsContent, clue.directions);
                    // Render arrows
                    const arrowsContainer = elements.dynamicContent.directionsArrowsContainer;
                    arrowsContainer.innerHTML = ''; // Clear old arrows
                    if (clue.directionsImages && clue.directionsImages.length > 0) {
                        clue.directionsImages.forEach(imgSrc => {
                            const img = document.createElement('img');
                            img.src = imgSrc;
                            img.className = 'arrow-icon';
                            img.onerror = () => img.style.display = 'none';
                            arrowsContainer.appendChild(img);
                        });
                    }
                } else if (screenName === 'clueStory') {
                    elements.dynamicContent.clueStorySubtitle.textContent = clue.title;
                    renderNarrative(elements.dynamicContent.clueStoryContent, clue.clueStory);
                }
            }

            function updateProgressScreen(isFinalReport = false) {
                gameState.isFinalReport = isFinalReport;
                const totalClues = gameData.clues.length;
                const cluesCompleted = gameState.currentClueIndex;
                const targetPercentage = totalClues > 0 ? Math.round((cluesCompleted / totalClues) * 100) : 0;

                // Animate the progress bar
                if (gameState.progressBarInterval) clearInterval(gameState.progressBarInterval);
                let currentBarPercentage = parseInt(elements.dynamicContent.progressBar.style.width) || 0;

                gameState.progressBarInterval = setInterval(() => {
                    if (currentBarPercentage < targetPercentage) {
                        currentBarPercentage++;
                        elements.dynamicContent.progressBar.style.width = `${currentBarPercentage}%`;
                        elements.dynamicContent.progressBar.textContent = `${currentBarPercentage}%`;
                    } else {
                        clearInterval(gameState.progressBarInterval);
                    }
                }, 20);

                // Animate Correctness Circle
                const targetCorrectness = cluesCompleted > 0 ? Math.round((gameState.correctAnswers / cluesCompleted) * 100) : 0;
                const circle = elements.dynamicContent.correctnessCircle;
                const radius = circle.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;
                circle.style.strokeDasharray = `${circumference} ${circumference}`;

                if (gameState.correctnessAnimationInterval) clearInterval(gameState.correctnessAnimationInterval);
                let currentCorrectness = parseInt(elements.dynamicContent.correctnessPercentage.textContent) || 0;

                gameState.correctnessAnimationInterval = setInterval(() => {
                    if (currentCorrectness < targetCorrectness) {
                        currentCorrectness++;
                    } else if (currentCorrectness > targetCorrectness) {
                        currentCorrectness--;
                    } else {
                        clearInterval(gameState.correctnessAnimationInterval);
                    }
                    const offset = circumference - currentCorrectness / 100 * circumference;
                    circle.style.strokeDashoffset = offset;
                    elements.dynamicContent.correctnessPercentage.textContent = `${currentCorrectness}%`;
                }, 20);

                // Apply sparkle effect
                const correctnessGraphic = elements.dynamicContent.correctnessGraphic;
                correctnessGraphic.classList.remove('sparkle-gold', 'sparkle-silver', 'sparkle-bronze');
                if (targetCorrectness >= 90) correctnessGraphic.classList.add('sparkle-gold');
                else if (targetCorrectness >= 75) correctnessGraphic.classList.add('sparkle-silver');
                else if (targetCorrectness >= 50) correctnessGraphic.classList.add('sparkle-bronze');


                elements.dynamicContent.progressMessage.textContent = `You have completed ${cluesCompleted} out of ${totalClues} clues.`;

                // Update Milestones
                for (const key in elements.dynamicContent.milestones) {
                    if (targetPercentage >= parseInt(key)) {
                        elements.dynamicContent.milestones[key].classList.add('active');
                    } else {
                        elements.dynamicContent.milestones[key].classList.remove('active');
                    }
                }

                // Update Summary
                elements.dynamicContent.progressSummary.innerHTML = `
                    <strong>Suspects Eliminated:</strong> ${gameState.eliminatedSuspects.length} <br>
                    <strong>Objects Eliminated:</strong> ${gameState.eliminatedObjects.length}
                `;

                // Update Motivational Quote
                const clueIndexForQuote = Math.max(0, gameState.currentClueIndex - 1);
                const quoteData = gameData.clues[clueIndexForQuote]?.motivationalQuote;
                if (quoteData && !isFinalReport) {
                    renderNarrative(elements.dynamicContent.motivationalQuoteContainer, [{ type: 'dialogue', character: quoteData.character, text: quoteData.text }]);
                } else {
                    elements.dynamicContent.motivationalQuoteContainer.innerHTML = '';
                }

                // Update button text based on game state
                if (gameState.currentClueIndex >= totalClues) {
                    elements.buttons.progressContinue.textContent = "See the Grand Reveal!";
                } else {
                    elements.buttons.progressContinue.textContent = "Next Clue";
                }

                navigateTo('progress');
            }


            function renderUI() {
                for (const screenKey in elements.screens) {
                    elements.screens[screenKey].classList.remove('active');
                }
                if (elements.screens[gameState.currentScreen]) {
                    elements.screens[gameState.currentScreen].classList.add('active');
                }
            }

            function loadClueScreen() {
                const clue = gameData.clues[gameState.currentClueIndex];
                if (!clue) return; // No more clues

                // Reset the task screen to its initial state
                elements.taskScreenViews.main.style.display = 'block';
                elements.taskScreenViews.selection.style.display = 'none';
                elements.taskScreenViews.feedback.style.display = 'none';
                elements.taskScreenViews.notebook.style.display = 'none';
                elements.taskScreenViews.cypher.style.display = 'none';

                elements.dynamicContent.taskSubtitle.textContent = clue.title; // Use title instead of subtitle

                // Populate dialogue container
                const dialogueContainer = elements.dynamicContent.taskDialogueContainer;
                dialogueContainer.innerHTML = ''; // Clear previous content

                const task = clue.task;
                const speakerData = gameData.characters.find(s => s.name === task.character);

                const dialogueClass = task.character === 'Hazel' ? 'dialogue-hazel' :
                                      task.character === 'Moo' ? 'dialogue-moo' : 'dialogue-other';
                dialogueContainer.className = 'dialogue-container'; // Reset
                dialogueContainer.classList.add(dialogueClass);

                if (speakerData) {
                    const avatar = document.createElement('img');
                    avatar.src = speakerData.img;
                    avatar.alt = speakerData.name;
                    avatar.className = 'character-avatar';
                    dialogueContainer.appendChild(avatar);
                }

                const dialogueP = document.createElement('p');
                dialogueP.textContent = `“${task.text}”`;
                dialogueContainer.appendChild(dialogueP);

                elements.buttons.showSuspects.disabled = clue.type !== 'suspect';
                elements.buttons.showObjects.disabled = clue.type !== 'object';

                // Handle Cypher button visibility
                if (clue.cypherImage) {
                    elements.buttons.showCypher.style.display = 'inline-block';
                } else {
                    elements.buttons.showCypher.style.display = 'none';
                }

                navigateTo('task');
            }

            function showGrid(type) {
                // Hide main view, show selection view
                elements.taskScreenViews.main.style.display = 'none';
                elements.taskScreenViews.selection.style.display = 'block';

                const items = [...gameData[type]];

                // Shuffle the items array using Fisher-Yates algorithm
                for (let i = items.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [items[i], items[j]] = [items[j], items[i]];
                }

                const singularType = type.slice(0, -1);
                const article = ['a', 'e', 'i', 'o', 'u'].includes(singularType.charAt(0).toLowerCase()) ? 'an' : 'a';
                elements.selectionGrid.title.textContent = `Select ${article} ${singularType}`;

                elements.selectionGrid.content.innerHTML = ''; // Clear previous grid items
                elements.selectionGrid.feedback.textContent = "Select one item as your answer.";
                gameState.playerSelection = null;

                items.forEach(item => {
                    const clone = elements.templates.gridItem.content.cloneNode(true);
                    const div = clone.querySelector('.grid-item');
                    const img = clone.querySelector('img');
                    const p = clone.querySelector('p');

                    div.dataset.name = item.name;
                    img.src = item.img;
                    img.alt = item.name;
                    p.textContent = item.name;

                    const isEliminated = (type === 'suspects' && gameState.eliminatedSuspects.includes(item.name)) ||
                                         (type === 'objects' && gameState.eliminatedObjects.includes(item.name));

                    if (isEliminated) {
                        div.classList.add('eliminated');
                    } else {
                        div.addEventListener('click', () => handleGridItemClick(item.name, div));
                    }

                    elements.selectionGrid.content.appendChild(clone);
                });
            }

            function handleGridItemClick(itemName, clickedElement) {
                const allItems = elements.selectionGrid.content.querySelectorAll('.grid-item');
                allItems.forEach(item => item.classList.remove('selected'));

                clickedElement.classList.add('selected');
                gameState.playerSelection = itemName;
                elements.selectionGrid.feedback.textContent = `Selected: ${itemName}`;
            }

            function closeGrid() {
                 // Hide selection view, show main view
                elements.taskScreenViews.selection.style.display = 'none';
                elements.taskScreenViews.main.style.display = 'block';
            }

            function confirmSelection() {
                const clue = gameData.clues[gameState.currentClueIndex];
                if (!gameState.playerSelection) {
                    elements.selectionGrid.feedback.textContent = "Please select an item first!";
                    return;
                }

                // Hide the selection grid
                elements.taskScreenViews.selection.style.display = 'none';

                const itemToEliminate = clue.answer;
                const isCorrect = gameState.playerSelection === clue.answer;

                // Update game state
                if (isCorrect) {
                    gameState.correctAnswers++;
                } else {
                    gameState.incorrectGuesses++;
                }

                if (clue.type === 'object') {
                    if (!gameState.eliminatedObjects.includes(itemToEliminate)) gameState.eliminatedObjects.push(itemToEliminate);
                } else if (clue.type === 'suspect') {
                    if (!gameState.eliminatedSuspects.includes(itemToEliminate)) gameState.eliminatedSuspects.push(itemToEliminate);
                }
                gameState.currentClueIndex++;

                // Show and populate the feedback view
                const feedbackContainer = elements.taskScreenViews.feedback;
                feedbackContainer.style.display = 'block';
                feedbackContainer.className = 'feedback-container ' + (isCorrect ? 'correct' : 'incorrect');

                elements.feedbackView.title.textContent = isCorrect ? "Correct!" : "Not Quite...";
                const narrative = isCorrect ? clue.correctAnswerReason : clue.wrongAnswerReason;
                renderNarrative(elements.feedbackView.narrative, narrative);
            }

            // --- Game End Flow Functions ---

            function showGrandReveal() {
                // Find the remaining suspect (the culprit)
                const culprit = gameData.suspects.find(s => !gameState.eliminatedSuspects.includes(s.name));
                // Find the remaining object (the tool)
                const usedObject = gameData.objects.find(o => !gameState.eliminatedObjects.includes(o.name));

                if (culprit) {
                    elements.reveal.culpritImg.src = culprit.img;
                    elements.reveal.culpritName.textContent = culprit.name;
                }
                if (usedObject) {
                    elements.reveal.usedObjectImg.src = usedObject.img;
                    elements.reveal.usedObjectName.textContent = usedObject.name;
                }

                // Render the reveal story
                renderNarrative(elements.reveal.storyContent, gameData.storyScreens.revealStory);

                navigateTo('grandReveal');
            }

            function showDetectiveAward() {
                // Calculate score
                const baseScore = gameState.correctAnswers * 100;
                const errorPenalty = gameState.incorrectGuesses * 25;

                gameState.finalScore = baseScore - errorPenalty;

                // Find the correct award tier
                let award = gameData.awardTiers.find(t => gameState.finalScore >= t.score) || gameData.awardTiers[gameData.awardTiers.length - 1];
                gameState.finalRank = award.title;

                // Populate the award screen
                elements.award.badgeImg.src = award.img;
                elements.award.badgeImg.alt = award.title;
                elements.award.titleText.textContent = award.title;

                // Populate score breakdown
                elements.award.baseScore.textContent = baseScore;
                elements.award.errorPenalty.textContent = `-${errorPenalty}`;
                elements.award.finalScore.textContent = Math.round(gameState.finalScore);

                // Replace placeholder and render dialogue
                const personalizedDialogue = award.dialogue.map(d => ({
                    type: 'dialogue',
                    character: d.character,
                    text: d.text.replace(/<player's name>/g, gameState.detectiveName)
                }));
                renderNarrative(elements.award.dialogueContainer, personalizedDialogue);

                navigateTo('detectiveAward');
            }

            function showCertificate() {
                elements.certificate.playerName.textContent = gameState.detectiveName;
                elements.certificate.rank.textContent = gameState.finalRank;
                navigateTo('certificate');
            }


            // --- EVENT LISTENERS ---
            elements.buttons.start.addEventListener('click', () => {
                // Reset game state for a new game
                gameState.detectiveName = '';
                gameState.currentScreen = 'welcome';
                gameState.currentClueIndex = 0;
                gameState.correctAnswers = 0;
                gameState.incorrectGuesses = 0;
                gameState.finalScore = 0;
                gameState.finalRank = '';
                gameState.playerSelection = null;
                gameState.eliminatedObjects = [];
                gameState.eliminatedSuspects = [];

                const name = elements.inputs.detectiveName.value.trim();
                gameState.detectiveName = name || 'Brave Detective';

                navigateTo('story');
            });

            elements.buttons.storyContinue.addEventListener('click', () => navigateTo('introStory'));
            elements.buttons.introStoryNext.addEventListener('click', () => navigateTo('cluePopup'));
            elements.buttons.directionsNext.addEventListener('click', () => navigateTo('clueStory'));
            elements.buttons.clueStorySolve.addEventListener('click', loadClueScreen);

            elements.buttons.showSuspects.addEventListener('click', () => showGrid('suspects'));
            elements.buttons.showObjects.addEventListener('click', () => showGrid('objects'));

            elements.buttons.closeGrid.addEventListener('click', closeGrid);
            elements.buttons.confirmSelection.addEventListener('click', () => {
    confirmSelection();
    saveGameState();
});

            elements.buttons.feedbackContinue.addEventListener('click', () => {
                updateProgressScreen();
            });

            elements.buttons.progressContinue.addEventListener('click', () => {
                if (gameState.currentClueIndex >= gameData.clues.length) {
                    showGrandReveal();
                } else {
                    navigateTo('cluePopup');
                }
            });

            elements.buttons.revealContinue.addEventListener('click', () => {
                showDetectiveAward();
            });

            elements.buttons.playAgain.addEventListener('click', () => {
                navigateTo('welcome');
            });

            elements.buttons.recap.addEventListener('click', () => {
                const clue = gameData.clues[gameState.currentClueIndex];
                if (!clue) return;

                const recapContent = elements.recapModal.content;
                recapContent.innerHTML = `
                    <h3 class="screen-subheader header-directions">Directions</h3>
                    <div id="recap-directions-content"></div>
                    <h3 class="screen-subheader header-story">Story</h3>
                    <div id="recap-story-content"></div>
                `;

                renderNarrative(document.getElementById('recap-directions-content'), clue.directions);
                renderNarrative(document.getElementById('recap-story-content'), clue.clueStory);

                elements.recapModal.container.style.display = 'flex';
            });

            elements.buttons.recapClose.addEventListener('click', () => {
                elements.recapModal.container.style.display = 'none';
            });

            elements.buttons.showCypher.addEventListener('click', () => {
                const clue = gameData.clues[gameState.currentClueIndex];
                if (clue && clue.cypherImage) {
                    elements.cypherView.img.src = clue.cypherImage;
                    elements.taskScreenViews.main.style.display = 'none';
                    elements.taskScreenViews.cypher.style.display = 'block';
                }
            });

            elements.buttons.cypherClose.addEventListener('click', () => {
                elements.taskScreenViews.cypher.style.display = 'none';
                elements.taskScreenViews.main.style.display = 'block';
            });

            elements.buttons.notebook.addEventListener('click', () => {
                const populateNotebookGrid = (gridElement, items, eliminatedItems) => {
                    gridElement.innerHTML = '';
                    items.forEach(item => {
                        const clone = elements.templates.gridItem.content.cloneNode(true);
                        const div = clone.querySelector('.grid-item');
                        const img = clone.querySelector('img');
                        const p = clone.querySelector('p');
                        div.style.cursor = 'default';
                        div.style.transform = 'none';

                        img.src = item.img;
                        img.alt = item.name;
                        p.textContent = item.name;

                        if (eliminatedItems.includes(item.name)) {
                            div.classList.add('eliminated');
                        }

                        gridElement.appendChild(clone);
                    });
                };
                populateNotebookGrid(elements.notebookView.suspectsGrid, gameData.suspects, gameState.eliminatedSuspects);
                populateNotebookGrid(elements.notebookView.objectsGrid, gameData.objects, gameState.eliminatedObjects);

                elements.taskScreenViews.main.style.display = 'none';
                elements.taskScreenViews.notebook.style.display = 'block';
            });

            elements.buttons.notebookClose.addEventListener('click', () => {
                elements.taskScreenViews.notebook.style.display = 'none';
                elements.taskScreenViews.main.style.display = 'block';
            });

            elements.buttons.viewCertificate.addEventListener('click', showCertificate);
            elements.buttons.certificateBack.addEventListener('click', () => navigateTo('detectiveAward'));
            elements.buttons.printCertificate.addEventListener('click', () => {
                window.print();
            });

            // --- INITIALIZATION ---
            function preloadAssets(callback) {
                const imageSrcs = new Set();

                // Collect all image sources automatically
                gameData.characters.forEach(c => imageSrcs.add(c.img));
                gameData.suspects.forEach(s => imageSrcs.add(s.img));
                gameData.objects.forEach(o => imageSrcs.add(o.img));
                gameData.awardTiers.forEach(t => imageSrcs.add(t.img));
                gameData.clues.forEach(clue => {
                    if (clue.directionsImages) {
                        clue.directionsImages.forEach(img => imageSrcs.add(img));
                    }
                    if (clue.cypherImage) {
                        imageSrcs.add(clue.cypherImage);
                    }
                });

                // Add any other standalone images here
                const otherImages = [
                    'garden-heist.png', 'welcome.png', 'intro.png',
                    'story-screen.png', 'clues-screen.png', 'grand-reveal.png',
                    'book.png', 'generic-error.png', 'detective-chart.png'
                ];
                otherImages.forEach(img => imageSrcs.add(img));

                const totalAssets = imageSrcs.size;
                let loadedAssets = 0;

                if (totalAssets === 0) {
                    callback();
                    return;
                }

                const updateProgressBar = () => {
                    loadedAssets++;
                    const percentage = Math.round((loadedAssets / totalAssets) * 100);
                    elements.loading.progressBar.style.width = `${percentage}%`;
                    elements.loading.progressBar.textContent = `${percentage}%`;
                    if (loadedAssets === totalAssets) {
                        // A small delay to allow the 100% to be visible
                        setTimeout(callback, 300);
                    }
                };

                // Create image elements to trigger download
                imageSrcs.forEach(src => {
                    if (!src) {
                        updateProgressBar(); // Count non-existent images as "loaded"
                        return;
                    }
                    const img = new Image();
                    img.onload = updateProgressBar;
                    img.onerror = updateProgressBar; // Also count errors as "loaded" to not halt the game
                    img.src = src;
                });
            }

            function init() {
                navigateTo('loading');
                preloadAssets(() => {
                    navigateTo('welcome');
                });
            }

            init();
        });
    </script>
    <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
      // Register the service worker from the root directory
      navigator.serviceWorker.register('/pwabuilder-sw').then(function(registration) {
        // Registration was successful
        console.log('ServiceWorker registration successful with scope: ', registration.scope);
      }, function(err) {
        // registration failed :(
        console.log('ServiceWorker registration failed: ', err);
      });
    });
  }
</script>

  
</body>
</html>
