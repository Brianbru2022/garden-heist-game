<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>The Lost Gem of the Ochil Giant</title>
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#36454F" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Welcome Screen -->
  <div id="welcome-screen" class="screen active">
    <div class="title" id="welcome-title">ðŸŒ³ The Garden Heist ðŸŒ³</div>
    <div class="subtitle" id="welcome-subtitle">A Wentworth Castle Gardens Mystery</div>
    <img id="welcome-image" src="garden-heist.png" alt="Main image" class="screen-image" />
    <div class="button-container">
      <button id="start-button">Start</button>
      <button id="reset-button">Reset Progress</button>
    </div>
  </div>

  <!-- Story Screen -->
  <div id="story-screen" class="screen">
    <div class="title">Story</div>
    <div id="story-screen-content"></div>
    <button class="next-button" data-next="suspects-screen">Next</button>
  </div>

  <!-- Suspects/Category A Screen -->
  <div id="suspects-screen" class="screen">
    <div class="title" id="suspects-title">Suspects</div>
    <div id="suspect-list"></div>
    <button class="next-button" data-next="objects-screen">Next</button>
  </div>

  <!-- Objects/Category B Screen -->
  <div id="objects-screen" class="screen">
    <div class="title" id="objects-title">Objects</div>
    <div id="object-list"></div>
    <button class="next-button" data-next="clues-screen">Next</button>
  </div>

  <!-- Clues Screen -->
  <div id="clues-screen" class="screen">
    <div class="title">Clues</div>
    <div id="clue-list"></div>
    <button class="next-button" data-next="end-screen">Finish</button>
  </div>

  <!-- End Screen -->
  <div id="end-screen" class="screen">
    <div class="title">Congratulations!</div>
    <p>Youâ€™ve completed the mystery.</p>
  </div>

  <!-- Scripts -->
  <script src="app-data-loader.js"></script>
  <script>
    let gameData;

    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function renderStory() {
      const container = document.getElementById('story-screen-content');
      container.innerHTML = '';
      (gameData.storyScreens.story || []).forEach(block => {
        const p = document.createElement('p');
        if (block.type === 'dialogue') {
          p.innerHTML = `<strong>${block.speaker || ''}:</strong> ${block.text}`;
        } else {
          p.textContent = block.text;
        }
        container.appendChild(p);
      });
    }

    function renderCategories() {
      // Category A (suspects or Trails, etc.)
      const suspectsTitle = document.getElementById('suspects-title');
      suspectsTitle.textContent = gameData.labels.primaryList;
      const suspectsList = document.getElementById('suspect-list');
      suspectsList.innerHTML = '';
      (gameData.suspects || []).forEach(item => {
        const div = document.createElement('div');
        div.className = 'list-item';
        div.textContent = item.name;
        suspectsList.appendChild(div);
      });

      // Category B (objects or Hidden Locations, etc.)
      const objectsTitle = document.getElementById('objects-title');
      objectsTitle.textContent = gameData.labels.secondaryList;
      const objectsList = document.getElementById('object-list');
      objectsList.innerHTML = '';
      (gameData.objects || []).forEach(item => {
        const div = document.createElement('div');
        div.className = 'list-item';
        div.textContent = item.name;
        objectsList.appendChild(div);
      });
    }

    function renderClues() {
      const clueList = document.getElementById('clue-list');
      clueList.innerHTML = '';
      (gameData.clues || []).forEach(clue => {
        const details = document.createElement('details');
        const summary = document.createElement('summary');
        summary.textContent = clue.title + (clue.subtitle ? ` â€” ${clue.subtitle}` : '');
        details.appendChild(summary);

        const body = document.createElement('div');
        if (clue.directions) {
          clue.directions.forEach(d => {
            const p = document.createElement('p');
            p.textContent = d.text;
            body.appendChild(p);
          });
        }
        if (clue.clueStory) {
          const p = document.createElement('p');
          p.innerHTML = `<em>${clue.clueStory}</em>`;
          body.appendChild(p);
        }
        if (clue.task) {
          const p = document.createElement('p');
          p.innerHTML = `<strong>Task:</strong> ${clue.task}`;
          body.appendChild(p);
        }
        details.appendChild(body);
        clueList.appendChild(details);
      });
    }

    function initGame() {
      // Welcome screen
      document.getElementById('welcome-title').textContent = gameData.config.title;
      document.getElementById('welcome-subtitle').textContent = gameData.config.subtitle;
      document.getElementById('welcome-image').src = gameData.config.mainImage;

      renderStory();
      renderCategories();
      renderClues();

      // Navigation
      document.querySelectorAll('.next-button').forEach(btn => {
        btn.addEventListener('click', () => {
          const next = btn.dataset.next;
          if (next) showScreen(next);
        });
      });

      document.getElementById('start-button').addEventListener('click', () => showScreen('story-screen'));
      document.getElementById('reset-button').addEventListener('click', () => {
        localStorage.clear();
        location.reload();
      });
    }

    // Load JSON â†’ init
    window.__loadGameData().then(data => {
      gameData = data;
      initGame();
    });
  </script>
</body>
</html>
